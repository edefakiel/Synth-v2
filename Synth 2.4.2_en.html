<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synesthesia Training 5.0</title>
<style>
:root{--rank0:rgb(136,136,136);--rank1:rgb(74,158,255);--rank2:rgb(170,110,255);--rank3:rgb(255,160,0);--rank4:rgb(255,60,60);--rank5:rgb(0,255,136);--rank5glow:rgba(0,255,136,.4)}
body{background:#0a0a0a;color:#fff;margin:0;padding:20px;font-family:'Segoe UI',Arial,sans-serif;overflow-x:hidden}
.block{width:30px;height:30px;display:inline-block;margin:2px;vertical-align:middle}
.circle{width:30px;height:30px;display:inline-block;border-radius:50%;margin:2px;vertical-align:middle}
.triangle{width:0;height:0;display:inline-block;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:30px solid;background:transparent;margin:2px;vertical-align:middle}
.punctuation{display:inline-block;margin:2px;padding:5px;min-width:20px;text-align:center;color:#fff;font-size:1.2em;vertical-align:middle}
@keyframes particle-burst{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}
.particle{position:fixed;width:10px;height:10px;border-radius:50%;pointer-events:none;animation:particle-burst .8s ease-out forwards;z-index:1000}
@keyframes notif-in{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
@keyframes notif-glow{0%,100%{box-shadow:0 0 10px var(--gc)}50%{box-shadow:0 0 25px var(--gc),0 0 50px var(--gc)}}
@keyframes notif-out{to{transform:translateX(100%);opacity:0}}
.notif{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:12px;font-weight:bold;font-size:.95em;z-index:1001;animation:notif-in .4s ease-out,notif-glow 1.5s ease-in-out infinite;pointer-events:none}
.notif.out{animation:notif-out .5s ease-in forwards}
.notif-streak{background:linear-gradient(135deg,#ff6b00,#ff9500);--gc:#ff6b00}
.notif-speed{background:linear-gradient(135deg,#00d4ff,#0099ff);--gc:#00d4ff}
.notif-level{background:linear-gradient(135deg,#9b59b6,#8e44ad);--gc:#9b59b6}
.notif-challenge{background:linear-gradient(135deg,#2ecc71,#27ae60);--gc:#2ecc71}
nav{text-align:center;margin-bottom:20px;border-bottom:1px solid #333;padding-bottom:10px}
nav button{padding:8px 12px;cursor:pointer;background:#1a1a1a;border:1px solid #333;margin:3px;border-radius:6px;font-weight:500;transition:all .3s;color:#ccc;font-size:.85em}
nav button:hover{background:#2a2a2a;border-color:#4a9eff;color:#fff}
#user-header{display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}
.hbadge{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #333;padding:8px 16px;border-radius:20px;font-size:.9em;display:flex;align-items:center;gap:8px}
.hbadge .icon{font-size:1.2em}.hbadge .lbl{color:#888}.hbadge .val{color:#fff;font-weight:bold}
#lvl-prog{width:100px;height:6px;background:#333;border-radius:3px;overflow:hidden}
#lvl-bar{height:100%;background:linear-gradient(90deg,#4a9eff,#00d4ff);transition:width .5s}
#daily-chal{background:linear-gradient(135deg,#1a1a2e,#0f3460);border:1px solid #4a9eff44;border-radius:12px;padding:12px 20px;margin-bottom:20px;max-width:500px;margin-left:auto;margin-right:auto}
#daily-chal h4{margin:0 0 8px;color:#4a9eff;font-size:.9em}
#daily-chal .ctxt{font-size:1em;margin-bottom:8px}
#daily-chal .cprog{display:flex;align-items:center;gap:10px}
#daily-chal .pbar{flex:1;height:8px;background:#333;border-radius:4px;overflow:hidden}
#daily-chal .pfill{height:100%;background:linear-gradient(90deg,#4a9eff,#00ff88);transition:width .3s}
#daily-chal .ptxt{font-size:.85em;color:#888;min-width:60px;text-align:right}
#daily-chal.done{border-color:#2ecc71;background:linear-gradient(135deg,#1a2e1a,#0f4630)}
#daily-chal.done h4{color:#2ecc71}
.section{display:none;text-align:center}.section.active{display:block}.hidden{display:none!important}
#escribir{width:80%;height:80px;font-size:1.2rem;margin-bottom:20px;padding:10px;background:#151515;color:#fff;border:1px solid #333;border-radius:8px}
#output{margin-top:20px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;line-height:40px}
#settings{max-width:800px;margin:0 auto;text-align:left}
.color-config{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin:20px 0}
.color-item{background:#151515;padding:10px;border-radius:8px;border:1px solid #333}
.color-item label{display:block;margin-bottom:5px;font-weight:bold}
.color-item input[type=color]{width:100%;height:40px;cursor:pointer;border:none;border-radius:4px}
#timer-bar-container{width:80%;max-width:500px;height:30px;background:#151515;border:2px solid #333;border-radius:15px;margin:20px auto;overflow:hidden;position:relative}
#timer-bar{height:100%;background:linear-gradient(90deg,#0f0,#ff0,#f00);transition:width .1s linear}
#timer-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-weight:bold;text-shadow:1px 1px 2px #000}
#start-game-btn{padding:20px 40px;font-size:1.5rem;cursor:pointer;background:linear-gradient(135deg,#0f0,#0c0);color:#000;border:none;border-radius:12px;font-weight:bold;margin:20px;transition:all .3s}
#start-game-btn:hover{transform:scale(1.05);box-shadow:0 0 20px #0f06}
#question-container{margin:40px auto;min-height:100px;display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap}
#options-container{display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
.option-btn{padding:15px 25px;font-size:1.5rem;cursor:pointer;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:8px;transition:all .3s}
.option-btn:hover{background:#2a2a2a;transform:scale(1.05);border-color:#4a9eff}
#feedback{margin:20px;font-size:1.8rem;min-height:40px}
.correct{color:#0f0}.wrong{color:#f44}
#next-btn{padding:10px 20px;font-size:1rem;cursor:pointer;background:#1a1a1a;color:#fff;border:1px solid #4a9eff;border-radius:8px}
#word-input-container{margin:20px}
#word-guess{padding:12px;font-size:1.2rem;width:300px;background:#151515;color:#fff;border:1px solid #333;border-radius:8px}
#mode-stats{display:inline-flex;gap:15px;background:#151515;padding:8px 16px;border-radius:20px;font-size:.85em;margin-bottom:15px;border:1px solid #333}
#mode-stats span{color:#888}#mode-stats .sv{color:#fff;font-weight:bold}#mode-stats .sr{color:#ffd700}
#cascade-game{position:relative;width:90%;max-width:600px;height:450px;margin:15px auto;border:2px solid #333;background:linear-gradient(180deg,#0a0a0a,#111);border-radius:12px;overflow:hidden}
#cascade-game::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40px;background:linear-gradient(transparent,#f003);pointer-events:none}
.falling-shape{position:absolute;transition:top .05s linear;filter:drop-shadow(0 0 5px currentColor)}
#cascade-input{margin:15px auto;padding:12px;font-size:1.8rem;width:180px;text-align:center;background:#151515;color:#fff;border:2px solid #333;border-radius:8px}
#cascade-input:focus{border-color:#4a9eff;outline:none}
#cascade-controls{margin:10px 0}
#cascade-controls button{padding:10px 25px;margin:5px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:all .3s}
#casc-start{background:linear-gradient(135deg,#0f0,#0c0);color:#000}
#casc-stop{background:linear-gradient(135deg,#f44,#c00);color:#fff}
#cascade-info{display:flex;justify-content:center;gap:30px;margin:10px 0;font-size:1.1em}
.cstat{background:#151515;padding:8px 16px;border-radius:8px;border:1px solid #333}
#memory-display{min-height:120px;display:flex;justify-content:center;align-items:center;gap:15px;flex-wrap:wrap;margin:30px auto}
#memory-input{padding:12px;font-size:1.5rem;width:250px;text-align:center;background:#151515;color:#fff;border:1px solid #333;border-radius:8px;letter-spacing:5px}
#memory-level-info{font-size:1.2em;margin:15px 0;color:#4a9eff}
#confusion-info{background:#151515;border:1px solid #333;border-radius:12px;padding:20px;max-width:600px;margin:20px auto;text-align:left}
#confusion-pairs{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:15px}
.conf-pair{background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:10px;text-align:center}
.conf-pair .chars{font-size:1.5em;font-weight:bold}.conf-pair .cnt{font-size:.8em;color:#888}
#stats-section{max-width:900px;margin:0 auto}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:20px 0}
.stat-card{background:#151515;border:1px solid #333;border-radius:12px;padding:20px}
.stat-card h3{margin:0 0 15px;color:#4a9eff;font-size:1em}
#heatmap-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(50px,1fr));gap:5px;max-width:600px;margin:0 auto}
.hm-cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.2em;border-radius:8px;transition:transform .2s}
.hm-cell:hover{transform:scale(1.1)}
#progress-chart{width:100%;height:200px;background:#0a0a0a;border-radius:8px;position:relative;overflow:hidden}
.chart-line{position:absolute;bottom:0;left:0;right:0;height:1px;background:#333}
.chart-bar{position:absolute;bottom:0;width:20px;background:linear-gradient(180deg,#4a9eff,#4a9eff88);border-radius:4px 4px 0 0;transition:height .5s}
.chart-labels{display:flex;justify-content:space-between;margin-top:10px;font-size:.8em;color:#666}
#guide{max-width:980px;margin:0 auto;text-align:left;line-height:1.55}
#guide h2,#guide h3,#guide h4{text-align:left;color:#4a9eff}
#guide h3{margin-top:30px}
#guide p,#guide li{color:#ddd}
#guide a{color:#6ab7ff;text-decoration:none}
#guide a:hover{text-decoration:underline}
.shape-examples{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin:14px 0 18px}
.shape-example{background:#111;border:1px solid #333;border-radius:12px;padding:12px;text-align:center}
.shape-example-title{font-weight:bold;margin-bottom:8px;color:#fff}
.color-table{width:100%;border-collapse:collapse;margin:10px 0 18px;overflow:hidden;border-radius:12px}
.color-table th,.color-table td{border-bottom:1px solid #222;padding:10px 12px;text-align:left}
.color-table th{background:#111;color:#4a9eff}
.color-table tr:nth-child(even) td{background:#0a0a0a}
.color-table td:first-child{font-weight:bold;font-size:1.5em}
details.guide-details{background:#0a0a0a;border:1px solid #333;border-radius:12px;padding:10px 12px;margin:10px 0}
details.guide-details summary{cursor:pointer;font-weight:bold;color:#fff}
.guide-note{background:#101826;border:1px solid #27415f;padding:12px 14px;border-radius:12px;margin:14px 0}
.rank-novato{color:var(--rank0)}.rank-aprendiz{color:var(--rank1)}.rank-avanzado{color:var(--rank2)}.rank-experto{color:var(--rank3)}.rank-maestro{color:var(--rank4)}.rank-sinesteta{color:var(--rank5);text-shadow:0 0 10px var(--rank5glow)}
</style>
</head>
<body>
<div id="user-header">
<div class="hbadge"><span class="icon">üèÜ</span><span class="lbl">Level:</span><span id="user-rank" class="val rank-novato">Novice</span><div id="lvl-prog"><div id="lvl-bar" style="width:0%"></div></div></div>
<div class="hbadge"><span class="icon">üî•</span><span class="lbl">Streak:</span><span id="day-streak" class="val">0 days</span></div>
<div class="hbadge"><span class="icon">‚ö°</span><span class="lbl">XP:</span><span id="total-xp" class="val">0</span></div>
</div>
<div id="daily-chal">
<h4>üéØ DAILY CHALLENGE</h4>
<div class="ctxt" id="chal-text">Loading...</div>
<div class="cprog"><div class="pbar"><div class="pfill" id="chal-prog" style="width:0%"></div></div><div class="ptxt" id="chal-ptxt">0/0</div></div>
</div>
<nav>
<button onclick="showSection('guide')">üìñ Guide</button>
<button onclick="showSection('translator')">üìù Translator</button>
<button onclick="showSection('settings')">‚öôÔ∏è Colors</button>
<button onclick="showSection('game-symbol-to-char')">üëÅÔ∏è Decode</button>
<button onclick="showSection('game-char-to-symbol')">üé® Find Color</button>
<button onclick="showSection('game-word')">üß† Word</button>
<button onclick="showSection('game-phrase')">üìö Phrase</button>
<button onclick="showSection('game-memory')">üí≠ Memory</button>
<button onclick="showSection('game-confusion')">üîÄ Confusions</button>
<button onclick="showSection('stats')">üìä Progress</button>
</nav>
<div id="guide" class="section active">
<h2>üìñ Grapheme-Color Synesthesia Guide</h2>
<h3>What is this?</h3>
<p>This tool helps you train and visualize grapheme-color synesthesia using intelligent spaced repetition. Each letter and number has a specific color and shape associated with it. The goal is to move from "conscious decoding" to "automatic recognition."</p>
<div class="guide-note">
<strong>üß† Scientific Evidence</strong><br/>
            A study published in Nature Scientific Reports (<a href="https://www.nature.com/articles/srep07089" target="_blank">Bor et al., 2014</a>) demonstrated that adults who followed a training regimen similar to this <strong>gained 12 IQ points</strong> after training grapheme-color associations. Synesthesia training can significantly enhance cognitive capabilities.
        </div>
<h3>üèÜ Progress, Ranks, and Daily Challenge</h3><p>Synth 5.0 includes an <strong>XP</strong> system, <strong>ranks</strong>, and <strong>daily streaks</strong> to keep your progress visible and consistent.</p><ul>
<li><strong>XP:</strong> You earn XP for correct answers (bonus for speed) and for completing objectives.</li>
<li><strong>Ranks:</strong> Novice ‚Üí Apprentice (500) ‚Üí Advanced (2000) ‚Üí Expert (5000) ‚Üí Master (10000) ‚Üí Synesthete (25000).</li>
<li><strong>Gain XP and Rank Up:</strong>
  <ul>
    <li><span class="rank-novato">Novice</span> ‚Äì 0 XP</li>
    <li><span class="rank-aprendiz">Apprentice</span> ‚Äì 500 XP</li>
    <li><span class="rank-avanzado">Advanced</span> ‚Äì 2,000 XP</li>
    <li><span class="rank-experto">Expert</span> ‚Äì 5,000 XP</li>
    <li><span class="rank-maestro">Master</span> ‚Äì 10,000 XP</li>
    <li><span class="rank-sinesteta">Synesthete</span> ‚Äì 25,000 XP</li>
  </ul>
</li>

<li><strong>Daily Streak:</strong> Increases if you play at least once a day.</li>
<li><strong>Daily Challenge:</strong> A new challenge appears every day (streak, accuracy, speed, or memory). Completing it grants extra XP.</li>
</ul><div class="guide-note"><strong>Tip:</strong> If you only have 2‚Äì3 minutes, complete the daily challenge. It's the easiest way to keep your streak alive.</div><h3>üé® Symbol Shapes</h3>
<p>The <strong>shape</strong> encodes the character type (uppercase/lowercase/number) and the <strong>color</strong> encodes the identity.</p>
<div class="shape-examples">
<div class="shape-example">
<div class="shape-example-title">Square</div>
<div class="block" style="background: #4a9eff; margin: 10px auto;"></div>
<p>Uppercase Letters<br/>(A, B, C...)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">Circle</div>
<div class="circle" style="background: #4a9eff; margin: 10px auto;"></div>
<p>Lowercase Letters<br/>(a, b, c...)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">Triangle</div>
<div class="triangle" style="border-bottom-color: #4a9eff; margin: 10px auto;"></div>
<p>Numbers<br/>(0, 1, 2...)</p>
</div>
</div>
<h3>üåà Letter and Number Colors</h3>
<details class="guide-details" open="">
<summary>üìã Complete Letter Table</summary>
<div style="margin-top: 10px;">
<table class="color-table">
<tr><th>Letter</th><th>Color</th><th>RGB</th></tr>
<tr><td style="color: rgb(55,55,225)">A</td><td>Blue</td><td>55,55,225</td></tr>
<tr><td style="color: rgb(255,85,168)">B</td><td>Pink</td><td>255,85,168</td></tr>
<tr><td style="color: rgb(114,244,47)">C</td><td>Lime Green</td><td>114,244,47</td></tr>
<tr><td style="color: rgb(255,255,0)">D</td><td>Yellow</td><td>255,255,0</td></tr>
<tr><td style="color: rgb(242,168,7)">E</td><td>Orange</td><td>242,168,7</td></tr>
<tr><td style="color: rgb(72,152,213)">F</td><td>Light Blue</td><td>72,152,213</td></tr>
<tr><td style="color: rgb(255,255,255)">G</td><td>White</td><td>255,255,255</td></tr>
<tr><td style="color: rgb(140,140,140)">H</td><td>Grey</td><td>140,140,140</td></tr>
<tr><td style="color: rgb(220,209,50)">I</td><td>Pale Yellow</td><td>220,209,50</td></tr>
<tr><td style="color: rgb(190,210,225)">J</td><td>Ice Blue</td><td>190,210,225</td></tr>
<tr><td style="color: rgb(170,170,170)">K</td><td>Light Grey</td><td>170,170,170</td></tr>
<tr><td style="color: rgb(255,148,173)">L</td><td>Light Pink</td><td>255,148,173</td></tr>
<tr><td style="color: rgb(221,194,156)">M</td><td>Beige</td><td>221,194,156</td></tr>
<tr><td style="color: rgb(21,148,141)">N</td><td>Teal</td><td>21,148,141</td></tr>
<tr><td style="color: rgb(240,120,0)">O</td><td>Dark Orange</td><td>240,120,0</td></tr>
<tr><td style="color: rgb(253,238,165)">P</td><td>Pale Yellow</td><td>253,238,165</td></tr>
<tr><td style="color: rgb(255,0,0)">Q</td><td>Red</td><td>255,0,0</td></tr>
<tr><td style="color: rgb(28,130,15)">R</td><td>Dark Green</td><td>28,130,15</td></tr>
<tr><td style="color: rgb(183,31,143)">S</td><td>Magenta</td><td>183,31,143</td></tr>
<tr><td style="color: rgb(172,128,77)">T</td><td>Brown</td><td>172,128,77</td></tr>
<tr><td style="color: rgb(0,170,80)">U</td><td>Green</td><td>0,170,80</td></tr>
<tr><td style="color: rgb(189,247,255)">V</td><td>Sky Blue</td><td>189,247,255</td></tr>
<tr><td style="color: rgb(123,20,95)">W</td><td>Purple</td><td>123,20,95</td></tr>
<tr><td style="color: rgb(190,25,25)">X</td><td>Dark Red</td><td>190,25,25</td></tr>
<tr><td style="color: rgb(209,240,163)">Y</td><td>Yellow Green</td><td>209,240,163</td></tr>
<tr><td style="color: rgb(116,61,37)">Z</td><td>Dark Brown</td><td>116,61,37</td></tr>
</table>
</div>
</details>
<details class="guide-details">
<summary>üî¢ Number Table</summary>
<div style="margin-top: 10px;">
<table class="color-table">
<tr><th>Number</th><th>Matches</th></tr>
<tr><td style="color: rgb(240,120,0)">0</td><td>O (Dark Orange)</td></tr>
<tr><td style="color: rgb(255,148,173)">1</td><td>L (Light Pink)</td></tr>
<tr><td style="color: rgb(255,255,0)">2</td><td>D (Yellow)</td></tr>
<tr><td style="color: rgb(221,194,156)">3</td><td>M (Beige)</td></tr>
<tr><td style="color: rgb(21,148,141)">4</td><td>N (Teal)</td></tr>
<tr><td style="color: rgb(183,31,143)">5</td><td>S (Magenta)</td></tr>
<tr><td style="color: rgb(255,85,168)">6</td><td>B (Pink)</td></tr>
<tr><td style="color: rgb(172,128,77)">7</td><td>T (Brown)</td></tr>
<tr><td style="color: rgb(255,255,255)">8</td><td>G (White)</td></tr>
<tr><td style="color: rgb(255,0,0)">9</td><td>Q (Red)</td></tr>
</table>
</div>
</details>
<h3>üéÆ Game Modes</h3>
<ul>
<li><strong>üëÅÔ∏è Decode Symbol:</strong> You see a colored shape and must identify which letter or number it is.</li>
<li><strong>üé® Find Color:</strong> You see a character and must select the correct color.</li>
<li><strong>üß† Decode Word:</strong> Read a coded word and type it, respecting case (10 seconds).</li>
<li><strong>üìö Decode Phrase:</strong> Read full phrases in context. Your brain uses semantic context to predict (20 seconds).</li>
<li><strong>üí≠ Memory Mode:</strong> Memorize a sequence of symbols and write it down. Length increases with your level.</li><li><strong>üîÄ Confusions Mode:</strong> Practice your most confused pairs. It automatically learns from your mistakes.</li><li><strong>üìä Progress:</strong> Mastery map, recent activity, and top confusions to know what to reinforce.</li></ul>
<h3>üìù Translator</h3><p>In <strong>üìù Translator</strong>, you can type any text and see it converted into symbols. Useful for practicing outside of games or creating learning materials.</p><h3>üí≠ Memory Mode Details</h3><p>A sequence of symbols is shown for a few seconds. Then, a box appears for you to write it down. If you get it right, you level up; if you fail, you level down (minimum level 1). Your best level is saved as a record.</p><h3>üîÄ Confusions Mode Details</h3><p>Every time you make a mistake in a multiple-choice mode, the pair <em>correct ‚Üî chosen</em> is recorded. This mode proposes exactly those symbols to help you eliminate the confusion.</p><h3>üéØ Spaced Repetition System</h3>
<p>The program learns from your mistakes. Symbols you get wrong appear more frequently until you master them. This intelligent system optimizes your training by automatically adjusting a "weight" for each symbol.</p>
<h3>‚è±Ô∏è Adaptive Timer</h3>
<ul>
<li><strong>Initial Time:</strong> 5s (symbols), 10s (words), 20s (phrases)</li>
<li><strong>Correct Answer:</strong> Time reduced by 10% (harder)</li>
<li><strong>Wrong Answer:</strong> Time increased by 10% (easier)</li>
<li><strong>Limits:</strong> Minimum 0.3s (for experts!), maximum varies by mode</li>
</ul>
<h3>üèÜ Records System</h3><p>Synth automatically saves your best scores (and notifies you):</p><ul>
<li><strong>Decode / Color:</strong> Best streak and best time (fastest response).</li>
<li><strong>Word / Phrase:</strong> Best streak.</li>
<li><strong>Memory:</strong> Best level reached and best streak in that mode.</li>
</ul><h3>üìä Stats and Progress</h3><p>In the <strong>üìä Progress</strong> tab, you will see:</p><ul>
<li><strong>Mastery Map:</strong> Each symbol is colored according to your accuracy (Green = Mastered, Red = Needs Practice). The tooltip shows % and number of attempts.</li>
<li><strong>Activity (Last 7 days):</strong> Bars showing your daily correct answers.</li>
<li><strong>Top Confusions:</strong> The pairs you confuse most often, so you can tackle the problem at the root.</li>
</ul><div class="guide-note"><strong>Saving:</strong> Everything is saved in your browser (localStorage). If you change devices or clear browser data, progress resets. You can also use <strong>üóëÔ∏è Clear Stats</strong> to start over.</div>

<h3>‚öôÔ∏è Customization</h3><p>Synesthesia is personal! In <strong>‚öôÔ∏è Colors</strong>, you can adjust the palette:</p><ul>
<li>Change the color of any letter or number.</li>
<li>Lowercase letters inherit the color of their uppercase counterpart (e.g., <em>a</em> uses the color of <em>A</em>).</li>
<li>Use <strong>Restore Colors</strong> to return to default values.</li>
</ul>

<h3>üí° Tips</h3>
<ul>
<li>Practice regularly to strengthen color-letter associations.</li>
<li>Short, frequent sessions are better (10 mins daily is better than 1 hour weekly).</li>
<li>Use the translator to visualize full texts.</li>
<li>You can load text files (.txt) into the translator.</li>
<li>Punctuation marks appear in white to remain visible.</li>
<li>In Word and Phrase modes: you must respect uppercase and lowercase exactly.</li>
<li>Stats are saved per game mode.</li>
</ul>
<h3>üë®‚Äçüíª Credits</h3>
<p>Designed by <a href="https://www.linkedin.com/in/alberto-fla%C3%B1o-lombardo-762618259/" style="font-weight: bold;" target="_blank">Alberto Fla√±o Lombardo</a></p>
</div>
<div id="translator" class="section">
<h2>üìù Text to Color Translator</h2>
<textarea id="escribir" placeholder="Type here..."></textarea>
<div><label for="file-input" style="cursor:pointer;padding:10px 20px;background:#1a1a1a;border:1px solid #333;border-radius:8px;display:inline-block;margin:10px">üìÑ Load File</label>
<input type="file" id="file-input" accept=".txt" style="display:none"></div>
<div id="output"></div>
</div>
<div id="settings" class="section">
<h2>‚öôÔ∏è Color Configuration</h2>
<p>Customize colors to match your synesthesia.</p>
<button onclick="resetColors()" style="padding:10px 20px;margin:20px;background:#f44;color:#fff;border:none;border-radius:8px;cursor:pointer">üîÑ Restore Defaults</button>
<div id="color-config-container" class="color-config"></div>
</div>
<div id="game-area" class="section">
<h2 id="game-title">Game Mode</h2>
<div id="mode-stats">
<span>‚ö° Streak: <span id="current-streak" class="sv">0</span>/<span id="best-streak" class="sr">0</span></span>
<span>üéØ Points: <span id="score" class="sv">0</span></span>
<span>‚è±Ô∏è Best: <span id="best-time" class="sr">--</span></span>
</div>
<button id="start-game-btn" onclick="startGameWithTimer()">‚ñ∂Ô∏è Start Game</button>
<div id="timer-bar-container" class="hidden"><div id="timer-bar" style="width:100%"></div><div id="timer-text">5.0s</div></div>
<div id="question-container"></div>
<div id="options-container"></div>
<div id="word-input-container" class="hidden"><input type="text" id="word-guess" placeholder="Type..." autocomplete="off"></div>
<div id="feedback"></div>
<button id="next-btn" onclick="continueAfterError()" class="hidden">Next ‚û°</button>
</div>
<div id="memory-section" class="section">
<h2>üí≠ Memory Mode</h2>
<p>Memorize the sequence and type it out.</p>
<div id="mode-stats">
<span>üìä Level: <span id="memory-level" class="sv">1</span></span>
<span>‚ö° Streak: <span id="memory-streak" class="sv">0</span></span>
<span>üèÜ Best: <span id="memory-best" class="sr">1</span></span>
</div>
<div id="memory-level-info">Level 1: 3 symbols</div>
<button id="memory-start-btn" onclick="startMemoryRound()">‚ñ∂Ô∏è Start</button>
<div id="memory-display"></div>
<div id="memory-input-container" class="hidden"><input type="text" id="memory-input" placeholder="Type the sequence..." autocomplete="off" maxlength="20"></div>
<div id="memory-feedback"></div>
</div>
<div id="confusion-section" class="section">
<h2>üîÄ Confusions Mode</h2>
<p>Practice symbols you confuse the most.</p>
<div id="confusion-info"><h4>Your most frequent confusions:</h4><div id="confusion-pairs"><p style="color:#666;text-align:center">Play other modes to detect confusions</p></div></div>
<button id="confusion-start-btn" onclick="startConfusionMode()" class="hidden">‚ñ∂Ô∏è Practice</button>
<div id="confusion-game" class="hidden"><div id="confusion-question"></div><div id="confusion-options"></div></div>
<div id="confusion-feedback"></div>
</div>
<div id="stats" class="section">
<h2>üìä Your Progress</h2>
<div class="stats-grid">
<div class="stat-card"><h3>üó∫Ô∏è Mastery Map</h3><p style="font-size:.85em;color:#666;margin-bottom:15px">Green = Mastered, Red = Needs Practice</p><div id="heatmap-container"></div></div>
<div class="stat-card"><h3>üìà Activity (Last 7 days)</h3><div id="progress-chart"></div><div class="chart-labels"><span>7 days ago</span><span>Today</span></div></div>
<div class="stat-card"><h3>üéØ Statistics</h3><div style="display:grid;gap:10px"><div>Total Correct: <strong id="stat-correct">0</strong></div><div>Total Wrong: <strong id="stat-wrong">0</strong></div><div>Accuracy: <strong id="stat-acc">100%</strong></div><div>Best Streak: <strong id="stat-streak">0</strong></div></div></div>
<div class="stat-card"><h3>üîÄ Top Confusions</h3><div id="top-confusions"><p style="color:#666">No data yet</p></div></div>
</div>
<button onclick="resetAllStats()" style="margin-top:20px;padding:10px 20px;background:#f442;color:#f44;border:1px solid #f44;border-radius:8px;cursor:pointer">üóëÔ∏è Clear Stats</button>
</div>
<script>
const defaultColors={A:'55,55,225',B:'255,85,168',C:'114,244,47',D:'255,255,0',E:'242,168,7',F:'72,152,213',G:'255,255,255',H:'140,140,140',I:'220,209,50',J:'190,210,225',K:'170,170,170',L:'255,148,173',M:'221,194,156',N:'21,148,141',O:'240,120,0',P:'253,238,165',Q:'255,0,0',R:'28,130,15',S:'183,31,143',T:'172,128,77',U:'0,170,80',V:'189,247,255',W:'123,20,95',X:'190,25,25',Y:'209,240,163',Z:'116,61,37','1':'255,148,173','2':'255,255,0','3':'221,194,156','4':'21,148,141','5':'183,31,143','6':'255,85,168','7':'172,128,77','8':'255,255,255','9':'255,0,0','0':'240,120,0',' ':'0,0,0'};
let colors={...defaultColors};
function updateRankColors(){
  const root=document.documentElement;
  const rgb=(v,fallback)=>'rgb('+(v||fallback)+')';
  const rgba=(v,fallback,a)=>'rgba('+(v||fallback)+','+a+')';
  root.style.setProperty('--rank0', rgb(colors['0'], '136,136,136'));
  root.style.setProperty('--rank1', rgb(colors['1'], '74,158,255'));
  root.style.setProperty('--rank2', rgb(colors['2'], '170,110,255'));
  root.style.setProperty('--rank3', rgb(colors['3'], '255,160,0'));
  root.style.setProperty('--rank4', rgb(colors['4'], '255,60,60'));
  root.style.setProperty('--rank5', rgb(colors['5'], '0,255,136'));
  root.style.setProperty('--rank5glow', rgba(colors['5'], '0,255,136', .4));
}

const words=["cat","dog","sun","sky","blue","red","sea","moon","night","day","art","code","mind","brain","light","dark","star","love","peace","dream","space","time","life","word","book","music","water","fire","earth","wind","green","tree","leaf","bird","fish","sand","rain","snow","cold","warm","fast","slow","happy","sad","kind","true","real","idea","plan","goal","path","road","city","town","home","work","play","game","data","link","web","net","soft","hard"];
const phrases=["The sun shines","Deep blue sea","Hello world","Time flies","Keep going","Never give up","Love and peace","Read a book","Write code","Open your mind","See the light","Stars at night","Green grass","Fresh water","Think big","Dream loud","Stay strong","Be kind","Learn fast","Play hard"];
const modeTitles={'game-symbol-to-char':'üëÅÔ∏è Decode','game-char-to-symbol':'üé® Find Color','game-word':'üß† Word','game-phrase':'üìö Phrase'};
const ranks=[{name:'Novice',xp:0,c:'rank-novato'},{name:'Apprentice',xp:500,c:'rank-aprendiz'},{name:'Advanced',xp:2000,c:'rank-avanzado'},{name:'Expert',xp:5000,c:'rank-experto'},{name:'Master',xp:10000,c:'rank-maestro'},{name:'Synesthete',xp:25000,c:'rank-sinesteta'}];
const challenges=[{type:'streak',target:10,text:'Streak of 10',xp:50},{type:'streak',target:20,text:'Streak of 20',xp:100},{type:'correct',target:30,text:'30 Correct Symbols',xp:50},{type:'correct',target:50,text:'50 Correct Symbols',xp:75},{type:'speed',target:3,text:'3 answers in <0.5s',xp:100},{type:'memory',target:5,text:'Memory Level 5',xp:75}];
let weights={},mode='',question=null,score=0,streak=0;
let data={xp:0,dayStreak:0,lastPlay:null,correct:0,wrong:0,bestStreak:0,dailyCorrect:0,dailyMaxStreak:0,dailyFast:0,confusions:{},symbolStats:{},records:{'game-symbol-to-char':{streak:0,time:null},'game-char-to-symbol':{streak:0,time:null},'game-word':{streak:0},'game-phrase':{streak:0},memory:{level:1,streak:0},cascade:{score:0,streak:0}},challenge:null,chalDate:null,chalProg:0,chalDone:false};
let timerInt=null,gameOn=false,qActive=false,qStart=0,maxTime=5000,timeLeft=5000;
let cascInt=null,cascShapes=[],cascLives=3,cascScore=0,cascStreak=0;
let memLevel=1,memSeq=[],memStreak=0;

function init(){getAllSymbols().forEach(s=>{weights[s]=10;if(!data.symbolStats[s])data.symbolStats[s]={c:0,w:0}});}
function load(){const s=localStorage.getItem('synth5_en');if(s)try{Object.assign(data,JSON.parse(s))}catch(e){};const c=localStorage.getItem('synth_colors_en');if(c)try{Object.assign(colors,JSON.parse(c))}catch(e){};updateRankColors();checkStreak();checkChallenge();updateHeader();updateChallengeUI();}
function save(){localStorage.setItem('synth5_en',JSON.stringify(data));}
function saveColors(){localStorage.setItem('synth_colors_en',JSON.stringify(colors));}
function resetColors(){colors={...defaultColors};localStorage.removeItem('synth_colors_en');buildColorConfig();updateRankColors();alert('Colors restored to defaults');}
function resetAllStats(){if(confirm('Delete all statistics? This cannot be undone.')){localStorage.removeItem('synth5_en');location.reload();}}
function today(){return new Date().toISOString().split('T')[0];}
function checkStreak(){const t=today(),l=data.lastPlay;if(!l)data.dayStreak=0;else if(l!==t){const d=Math.floor((new Date(t)-new Date(l))/(864e5));if(d===1)data.dayStreak++;else if(d>1)data.dayStreak=0;}}
function markPlayed(){const t=today();if(data.lastPlay!==t){data.lastPlay=t;data.dailyCorrect=0;data.dailyMaxStreak=0;data.dailyFast=0;checkStreak();data.dayStreak=Math.max(1,data.dayStreak);save();updateHeader();}}
function checkChallenge(){const t=today();if(data.chalDate!==t){const c=challenges[Math.floor(Math.random()*challenges.length)];data.challenge=c;data.chalDate=t;data.chalProg=0;data.chalDone=false;save();}}
function updateChallengeProgress(){if(!data.challenge||data.chalDone)return;const c=data.challenge;let p=0;if(c.type==='streak')p=data.dailyMaxStreak;else if(c.type==='correct')p=data.dailyCorrect;else if(c.type==='speed')p=data.dailyFast;else if(c.type==='memory')p=data.records.memory.level;else if(c.type==='cascade')p=data.records.cascade.score;data.chalProg=p;if(p>=c.target&&!data.chalDone){data.chalDone=true;addXP(c.xp);notify('challenge','Challenge Complete! +'+c.xp+' XP');}updateChallengeUI();save();}
function updateChallengeUI(){const el=document.getElementById('daily-chal');if(!data.challenge)return;const c=data.challenge,p=data.chalProg||0,t=c.target;document.getElementById('chal-text').textContent=c.text+(data.chalDone?' ‚úÖ':' (+'+c.xp+' XP)');document.getElementById('chal-prog').style.width=Math.min(100,p/t*100)+'%';document.getElementById('chal-ptxt').textContent=Math.min(p,t)+'/'+t;el.classList.toggle('done',data.chalDone);}
function addXP(n){const old=getRank();data.xp+=n;const now=getRank();if(now.name!==old.name)notify('level','Rank Up: '+now.name+'!');updateHeader();save();}
function getRank(){for(let i=ranks.length-1;i>=0;i--)if(data.xp>=ranks[i].xp)return ranks[i];return ranks[0];}
function getNextRank(){const c=getRank(),i=ranks.findIndex(r=>r.name===c.name);return ranks[i+1]||null;}
function updateHeader(){const r=getRank(),n=getNextRank();document.getElementById('user-rank').textContent=r.name;document.getElementById('user-rank').className='val '+r.c;document.getElementById('day-streak').textContent=data.dayStreak+' days';document.getElementById('total-xp').textContent=data.xp.toLocaleString();if(n)document.getElementById('lvl-bar').style.width=((data.xp-r.xp)/(n.xp-r.xp)*100)+'%';else document.getElementById('lvl-bar').style.width='100%';}
function recordConfusion(a,b){const k=[a.toUpperCase(),b.toUpperCase()].sort().join('-');data.confusions[k]=(data.confusions[k]||0)+1;save();}
function getTopConf(n=5){return Object.entries(data.confusions).sort((a,b)=>b[1]-a[1]).slice(0,n);}
function getConfSymbols(){const c=getTopConf(10),s=new Set();c.forEach(([p,n])=>{if(n>=2){const[a,b]=p.split('-');s.add(a);s.add(b);}});return Array.from(s);}
function notify(type,msg){document.querySelectorAll('.notif').forEach(n=>n.remove());const d=document.createElement('div');d.className='notif notif-'+type;d.innerHTML=msg;document.body.appendChild(d);setTimeout(()=>{d.classList.add('out');setTimeout(()=>d.remove(),500);},2500);}
function getShape(c){if(c>='A'&&c<='Z')return'block';if(c>='a'&&c<='z')return'circle';if(c>='0'&&c<='9')return'triangle';return'punctuation';}
function makeShape(c){const u=c.toUpperCase(),col=colors[u]||'0,0,0',sh=getShape(c);if(c===' '){const s=document.createElement('div');s.style.cssText='width:20px;height:30px;display:inline-block';return s;}if(sh==='punctuation'){const s=document.createElement('span');s.className='punctuation';s.textContent=c;return s;}const d=document.createElement('div');d.className=sh;if(sh==='triangle')d.style.borderBottomColor='rgb('+col+')';else d.style.backgroundColor='rgb('+col+')';return d;}
function wrapScale(el,s){const w=document.createElement('div');w.style.display='inline-block';w.style.transform='scale('+s+')';w.style.transformOrigin='center';w.appendChild(el);return w;}
function getAllSymbols(){const s=[];'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach(c=>s.push(c));'abcdefghijklmnopqrstuvwxyz'.split('').forEach(c=>s.push(c));'0123456789'.split('').forEach(c=>s.push(c));return s;}
function weightedRandom(){const items=Object.keys(weights),total=items.reduce((s,i)=>s+weights[i],0);let r=Math.random()*total,sum=0;for(let i of items){sum+=weights[i];if(r<=sum)return i;}return items[0];}
function particles(x,y,col){for(let i=0;i<12;i++){const p=document.createElement('div');p.className='particle';p.style.left=x+'px';p.style.top=y+'px';p.style.backgroundColor='rgb('+col+')';const a=(Math.PI*2*i)/12,d=100+Math.random()*50;p.style.setProperty('--tx',Math.cos(a)*d+'px');p.style.setProperty('--ty',Math.sin(a)*d+'px');document.body.appendChild(p);setTimeout(()=>p.remove(),800);}}
function rgbToHex(r){const[a,b,c]=r.split(',').map(v=>parseInt(v.trim()));return'#'+[a,b,c].map(x=>x.toString(16).padStart(2,'0')).join('');}
function hexToRgb(h){return parseInt(h.slice(1,3),16)+','+parseInt(h.slice(3,5),16)+','+parseInt(h.slice(5,7),16);}
function translate(t){const o=document.getElementById('output');o.innerHTML='';for(const c of t)o.appendChild(makeShape(c));}
function buildColorConfig(){const c=document.getElementById('color-config-container');c.innerHTML='';'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('').forEach(l=>{const col=colors[l];if(!col)return;const d=document.createElement('div');d.className='color-item';const lb=document.createElement('label');lb.textContent=l;lb.style.color='rgb('+col+')';const inp=document.createElement('input');inp.type='color';inp.value=rgbToHex(col);inp.onchange=e=>{colors[l]=hexToRgb(e.target.value);lb.style.color='rgb('+colors[l]+')';saveColors();updateRankColors();};d.appendChild(lb);d.appendChild(inp);c.appendChild(d);});updateRankColors();}

window.showSection=function(m){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));if(m==='guide')document.getElementById('guide').classList.add('active');else if(m==='translator')document.getElementById('translator').classList.add('active');else if(m==='settings'){document.getElementById('settings').classList.add('active');buildColorConfig();}else if(m==='game-memory'){document.getElementById('memory-section').classList.add('active');resetMemory();}else if(m==='game-confusion'){document.getElementById('confusion-section').classList.add('active');setupConfusion();}else if(m==='stats'){document.getElementById('stats').classList.add('active');updateStats();}else{document.getElementById('game-area').classList.add('active');startGame(m);}};
function startGame(m){mode=m;score=0;streak=0;document.getElementById('game-title').textContent=modeTitles[m]||'Game';maxTime=m==='game-phrase'?20000:m==='game-word'?10000:5000;gameOn=false;qActive=false;updateModeStats();document.getElementById('start-game-btn').classList.remove('hidden');document.getElementById('timer-bar-container').classList.add('hidden');document.getElementById('question-container').innerHTML='';document.getElementById('options-container').innerHTML='';document.getElementById('feedback').textContent='';}
window.startGameWithTimer=function(){gameOn=true;markPlayed();document.getElementById('start-game-btn').classList.add('hidden');document.getElementById('timer-bar-container').classList.remove('hidden');nextQ();};
function updateModeStats(){if(!mode||!data.records[mode])return;const r=data.records[mode];document.getElementById('current-streak').textContent=streak;document.getElementById('best-streak').textContent=r.streak||0;document.getElementById('score').textContent=score;document.getElementById('best-time').textContent=r.time?(r.time/1000).toFixed(2)+'s':'--';}
function startTimer(){if(timerInt)clearInterval(timerInt);qActive=true;timeLeft=maxTime;qStart=Date.now();timerInt=setInterval(()=>{const e=Date.now()-qStart;timeLeft=maxTime-e;if(timeLeft<=0){clearInterval(timerInt);qActive=false;handleWrong(question,null,true);}else updateTimerDisplay();},100);}
function stopTimer(){if(timerInt){clearInterval(timerInt);timerInt=null;}qActive=false;}
function updateTimerDisplay(){document.getElementById('timer-bar').style.width=(timeLeft/maxTime*100)+'%';document.getElementById('timer-text').textContent=(timeLeft/1000).toFixed(1)+'s';}
function handleCorrect(sym){if(!qActive)return;const rt=Date.now()-qStart;stopTimer();weights[sym]=Math.max(1,weights[sym]-2);const st=data.symbolStats[sym.toUpperCase()];if(st)st.c++;const col=colors[sym.toUpperCase()]||'255,255,255';particles(innerWidth/2,innerHeight/2,col);document.getElementById('feedback').innerHTML="<span class='correct'>CORRECT!</span>";score++;streak++;data.correct++;data.dailyCorrect++;recordDailyActivity();let xp=5;if(rt<500){xp+=5;data.dailyFast++;}addXP(xp);if(streak>data.dailyMaxStreak)data.dailyMaxStreak=streak;if(streak>data.bestStreak)data.bestStreak=streak;const r=data.records[mode];if(streak>(r.streak||0)){r.streak=streak;notify('streak','üî• Streak Record: '+streak+'!');}if((mode==='game-symbol-to-char'||mode==='game-char-to-symbol')&&(r.time===null||rt<r.time)){r.time=rt;notify('speed','‚ö° Speed: '+(rt/1000).toFixed(2)+'s!');}const minT=mode==='game-phrase'?3000:mode==='game-word'?1500:300;maxTime=Math.max(minT,maxTime*0.9);updateModeStats();updateChallengeProgress();save();setTimeout(nextQ,800);}
function handleWrong(ans,wrong,timeout){if(!qActive&&!timeout)return;stopTimer();weights[ans]=Math.min(50,weights[ans]+5);if(wrong)recordConfusion(ans,wrong);const st=data.symbolStats[ans.toUpperCase()];if(st)st.w++;data.wrong++;const col=colors[ans.toUpperCase()]||'255,255,255';document.getElementById('feedback').innerHTML="<span class='wrong'>"+(timeout?'‚è±Ô∏è ':'')+"It was: </span><span style='color:rgb("+col+");font-weight:bold;font-size:1.5em'>"+ans+"</span>";streak=0;maxTime=Math.min(mode==='game-phrase'?20000:mode==='game-word'?10000:5000,maxTime*1.1);updateModeStats();save();showCorrectOption(ans);}
window.continueAfterError=function(){document.getElementById('next-btn').classList.add('hidden');nextQ();};
window.nextQ=function(){if(!gameOn)return;const qC=document.getElementById('question-container'),oC=document.getElementById('options-container'),wC=document.getElementById('word-input-container'),fb=document.getElementById('feedback'),nb=document.getElementById('next-btn'),wi=document.getElementById('word-guess');qC.innerHTML='';oC.innerHTML='';fb.textContent='';wC.classList.add('hidden');nb.classList.add('hidden');wi.value='';if(mode==='game-symbol-to-char'){const c=weightedRandom();question=c;const sh=makeShape(c),sw=wrapScale(sh,2.5);sw.style.margin='20px';qC.appendChild(sw);genOpts(c,getAllSymbols(),'text');startTimer();}else if(mode==='game-char-to-symbol'){const c=weightedRandom();question=c;const d=document.createElement('div');d.textContent=c;d.style.fontSize='4rem';d.style.fontWeight='bold';qC.appendChild(d);genOpts(c,getAllSymbols(),'visual');startTimer();}else if(mode==='game-word'){const w=words[Math.floor(Math.random()*words.length)];question=w;const wc=document.createElement('div');wc.style.cssText='display:flex;gap:5px;flex-wrap:wrap;justify-content:center';for(let c of w)wc.appendChild(makeShape(c));qC.appendChild(wc);wC.classList.remove('hidden');wi.focus();startTimer();}else if(mode==='game-phrase'){const p=phrases[Math.floor(Math.random()*phrases.length)];question=p;const pc=document.createElement('div');pc.style.cssText='display:flex;gap:5px;flex-wrap:wrap;justify-content:center';for(let c of p)pc.appendChild(makeShape(c));qC.appendChild(pc);wC.classList.remove('hidden');wi.focus();startTimer();}};
function genOpts(correct,all,type){let opts=[correct];while(opts.length<4){let r=all[Math.floor(Math.random()*all.length)];if(!opts.includes(r))opts.push(r);}opts.sort(()=>Math.random()-0.5);opts.forEach(o=>{const btn=document.createElement('button');btn.className='option-btn';btn.dataset.char=o;if(type==='text')btn.textContent=o;else{const sh=makeShape(o),sw=wrapScale(sh,1.5);btn.appendChild(sw);}btn.onclick=()=>{if(!qActive)return;if(o===correct)handleCorrect(correct);else handleWrong(correct,o,false);};document.getElementById('options-container').appendChild(btn);});}
function checkWord(){if(!qActive)return;const v=document.getElementById('word-guess').value.trim();if(v===question){stopTimer();document.getElementById('feedback').innerHTML="<span class='correct'>Excellent!</span>";score+=5;streak++;data.correct++;data.dailyCorrect++;addXP(15);if(streak>data.dailyMaxStreak)data.dailyMaxStreak=streak;if(streak>data.bestStreak)data.bestStreak=streak;const r=data.records[mode];if(streak>(r.streak||0)){r.streak=streak;notify('streak','üî• Streak: '+streak+'!');}const minT=mode==='game-phrase'?3000:1500;maxTime=Math.max(minT,maxTime*0.9);updateModeStats();updateChallengeProgress();save();particles(innerWidth/2,300,'255,255,0');setTimeout(nextQ,1000);}else if(v.length===question.length)handleWrong(question,null,false);}
function showCorrectOption(ans){const btns=document.querySelectorAll('.option-btn');btns.forEach(btn=>{const isCorrect=(btn.textContent===ans)||(btn.dataset&&btn.dataset.char===ans);if(isCorrect){btn.style.border='3px solid #0f0';btn.style.boxShadow='0 0 15px #0f0';btn.onclick=()=>{nextQ();};}else{btn.style.opacity='0.3';btn.onclick=null;}});if(mode==='game-word'||mode==='game-phrase'){document.getElementById('next-btn').classList.remove('hidden');}}
function recordDailyActivity(){const t=today();if(!data.activityHistory)data.activityHistory={};data.activityHistory[t]=data.dailyCorrect;const keys=Object.keys(data.activityHistory).sort();if(keys.length>14){delete data.activityHistory[keys[0]];}save();}
function resetMemory(){memLevel=1;memStreak=0;memSeq=[];updateMemoryUI();document.getElementById('memory-display').innerHTML='';document.getElementById('memory-input-container').classList.add('hidden');document.getElementById('memory-feedback').textContent='';document.getElementById('memory-start-btn').classList.remove('hidden');}
function updateMemoryUI(){document.getElementById('memory-level').textContent=memLevel;document.getElementById('memory-streak').textContent=memStreak;document.getElementById('memory-best').textContent=data.records.memory.level||1;document.getElementById('memory-level-info').textContent='Level '+memLevel+': '+(memLevel+2)+' symbols';}
window.startMemoryRound=function(){markPlayed();document.getElementById('memory-start-btn').classList.add('hidden');document.getElementById('memory-feedback').textContent='';document.getElementById('memory-input-container').classList.add('hidden');const len=memLevel+2;memSeq=[];const base='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';for(let i=0;i<len;i++)memSeq.push(base[Math.floor(Math.random()*base.length)]);const disp=document.getElementById('memory-display');disp.innerHTML='';memSeq.forEach((c,i)=>{const sh=makeShape(c),sw=wrapScale(sh,1.8);sw.style.opacity='0';sw.style.transition='opacity 0.3s';disp.appendChild(sw);setTimeout(()=>{sw.style.opacity='1';},i*400);});setTimeout(()=>{disp.innerHTML='<p style="color:#666">What was the sequence?</p>';document.getElementById('memory-input-container').classList.remove('hidden');document.getElementById('memory-input').value='';document.getElementById('memory-input').maxLength=memSeq.length;document.getElementById('memory-input').focus();},memSeq.length*400+1500);};
function checkMemory(){const inp=document.getElementById('memory-input').value.toUpperCase(),correct=memSeq.join('');if(inp===correct){memStreak++;memLevel++;addXP(10+memLevel*2);if(memLevel>data.records.memory.level){data.records.memory.level=memLevel;notify('level','üí≠ Level Record: '+memLevel+'!');}document.getElementById('memory-feedback').innerHTML='<span class="correct">Correct!</span>';updateMemoryUI();updateChallengeProgress();save();setTimeout(startMemoryRound,1500);}else{document.getElementById('memory-feedback').innerHTML='<span class="wrong">It was: '+correct+'</span>';memStreak=0;memLevel=Math.max(1,memLevel-1);updateMemoryUI();save();document.getElementById('memory-input-container').classList.add('hidden');document.getElementById('memory-start-btn').classList.remove('hidden');}}
function setupConfusion(){const conf=getTopConf(10),cont=document.getElementById('confusion-pairs');if(conf.length===0){cont.innerHTML='<p style="color:#666;text-align:center">Play other modes to detect confusions</p>';document.getElementById('confusion-start-btn').classList.add('hidden');return;}cont.innerHTML='';conf.forEach(([pair,cnt])=>{const[a,b]=pair.split('-'),colA=colors[a]||'255,255,255',colB=colors[b]||'255,255,255';const d=document.createElement('div');d.className='conf-pair';d.innerHTML='<div class="chars"><span style="color:rgb('+colA+')">'+a+'</span> ‚Üî <span style="color:rgb('+colB+')">'+b+'</span></div><div class="cnt">'+cnt+'x</div>';cont.appendChild(d);});document.getElementById('confusion-start-btn').classList.remove('hidden');}
window.startConfusionMode=function(){const syms=getConfSymbols();if(syms.length<2){alert('Not enough data. Keep practicing!');return;}markPlayed();document.getElementById('confusion-info').classList.add('hidden');document.getElementById('confusion-start-btn').classList.add('hidden');document.getElementById('confusion-game').classList.remove('hidden');confQuestion(syms);};
function confQuestion(syms){const correct=syms[Math.floor(Math.random()*syms.length)],qC=document.getElementById('confusion-question'),oC=document.getElementById('confusion-options');qC.innerHTML='';oC.innerHTML='';document.getElementById('confusion-feedback').textContent='';const sh=makeShape(correct),sw=wrapScale(sh,2.5);sw.style.margin='20px';qC.appendChild(sw);let opts=[correct];const others=syms.filter(s=>s!==correct);while(opts.length<Math.min(4,syms.length)&&others.length>0)opts.push(others.splice(Math.floor(Math.random()*others.length),1)[0]);opts.sort(()=>Math.random()-0.5);opts.forEach(o=>{const btn=document.createElement('button');btn.className='option-btn';btn.dataset.char=o;btn.textContent=o;btn.onclick=()=>{if(o===correct){document.getElementById('confusion-feedback').innerHTML='<span class="correct">Correct!</span>';addXP(10);data.correct++;save();particles(innerWidth/2,300,colors[correct]||'255,255,255');setTimeout(()=>confQuestion(syms),800);}else{document.getElementById('confusion-feedback').innerHTML='<span class="wrong">It was: '+correct+'</span>';recordConfusion(correct,o);data.wrong++;save();setTimeout(()=>confQuestion(syms),1500);}};oC.appendChild(btn);});}
function updateStats(){buildHeatmap();buildChart();const t=data.correct+data.wrong,acc=t>0?Math.round(data.correct/t*100):100;document.getElementById('stat-correct').textContent=data.correct.toLocaleString();document.getElementById('stat-wrong').textContent=data.wrong.toLocaleString();document.getElementById('stat-acc').textContent=acc+'%';document.getElementById('stat-streak').textContent=data.bestStreak;const conf=getTopConf(5),tc=document.getElementById('top-confusions');if(conf.length===0){tc.innerHTML='<p style="color:#666">No data yet</p>';return;}tc.innerHTML='';conf.forEach(([pair,cnt],i)=>{const[a,b]=pair.split('-'),colA=colors[a]||'255,255,255',colB=colors[b]||'255,255,255';const d=document.createElement('div');d.style.cssText='display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #222';d.innerHTML='<span>'+(i+1)+'. <span style="color:rgb('+colA+');font-weight:bold">'+a+'</span> ‚Üî <span style="color:rgb('+colB+');font-weight:bold">'+b+'</span></span><span style="color:#888">'+cnt+'x</span>';tc.appendChild(d);});}
function buildHeatmap(){const c=document.getElementById('heatmap-container');c.innerHTML='';'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('').forEach(sym=>{const st=data.symbolStats[sym],t=st?st.c+st.w:0,acc=t>0?st.c/t:0.5;let r,g;if(acc<0.5){r=255;g=Math.round(acc*2*255);}else{r=Math.round((1-acc)*2*255);g=255;}const col=colors[sym]||'150,150,150',bg=t>0?'rgb('+r+','+g+',0)':'#333';const cell=document.createElement('div');cell.className='hm-cell';cell.style.backgroundColor=bg;cell.style.color='rgb('+col+')';cell.textContent=sym;cell.title=sym+': '+(t>0?Math.round(acc*100)+'%':'No Data')+' ('+t+')';c.appendChild(cell);});}
function buildChart(){const c=document.getElementById('progress-chart');c.innerHTML='';const days=7,bw=(c.offsetWidth-40)/days;const t=today();const hist=data.activityHistory||{};const dates=[];for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);dates.push(d.toISOString().split('T')[0]);}const maxVal=Math.max(50,...dates.map(d=>hist[d]||0));dates.forEach((date,i)=>{const bar=document.createElement('div');bar.className='chart-bar';bar.style.left=(20+i*bw)+'px';bar.style.width=(bw-10)+'px';const val=hist[date]||0;const h=maxVal>0?(val/maxVal)*100:0;bar.style.height=h+'%';bar.title=date+': '+val+' correct';c.appendChild(bar);});[25,50,75].forEach(p=>{const l=document.createElement('div');l.className='chart-line';l.style.bottom=p+'%';c.appendChild(l);});}
document.addEventListener('DOMContentLoaded',()=>{init();load();const ta=document.getElementById('escribir');if(ta)ta.oninput=e=>translate(e.target.value);const fi=document.getElementById('file-input');if(fi)fi.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{ta.value=ev.target.result;translate(ev.target.result);};r.readAsText(f);}};const wi=document.getElementById('word-guess');if(wi){wi.oninput=function(){if(question&&this.value.length>=question.length)checkWord();};wi.onkeypress=e=>{if(e.key==='Enter')checkWord();};}const mi=document.getElementById('memory-input');if(mi){mi.oninput=function(){if(this.value.length>=memSeq.length)checkMemory();};mi.onkeypress=e=>{if(e.key==='Enter')checkMemory();};}});
</script>
</body>
</html>