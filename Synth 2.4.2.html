<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entrenamiento Sinestesia 5.0</title>
<style>
:root{--rank0:rgb(136,136,136);--rank1:rgb(74,158,255);--rank2:rgb(170,110,255);--rank3:rgb(255,160,0);--rank4:rgb(255,60,60);--rank5:rgb(0,255,136);--rank5glow:rgba(0,255,136,.4)}
body{background:#0a0a0a;color:#fff;margin:0;padding:20px;font-family:'Segoe UI',Arial,sans-serif;overflow-x:hidden}
.block{width:30px;height:30px;display:inline-block;margin:2px;vertical-align:middle}
.circle{width:30px;height:30px;display:inline-block;border-radius:50%;margin:2px;vertical-align:middle}
.triangle{width:0;height:0;display:inline-block;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:30px solid;background:transparent;margin:2px;vertical-align:middle}
.parallelogram{width:30px;height:30px;transform:skew(20deg);display:inline-block;margin:2px;vertical-align:middle}
.oval{height:25px;width:35px;display:inline-block;border-radius:50%;margin:2px;vertical-align:middle}
.punctuation{display:inline-block;margin:2px;padding:5px;min-width:20px;text-align:center;color:#fff;font-size:1.2em;vertical-align:middle}
@keyframes particle-burst{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}
.particle{position:fixed;width:10px;height:10px;border-radius:50%;pointer-events:none;animation:particle-burst .8s ease-out forwards;z-index:1000}
@keyframes notif-in{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
@keyframes notif-glow{0%,100%{box-shadow:0 0 10px var(--gc)}50%{box-shadow:0 0 25px var(--gc),0 0 50px var(--gc)}}
@keyframes notif-out{to{transform:translateX(100%);opacity:0}}
.notif{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:12px;font-weight:bold;font-size:.95em;z-index:1001;animation:notif-in .4s ease-out,notif-glow 1.5s ease-in-out infinite;pointer-events:none}
.notif.out{animation:notif-out .5s ease-in forwards}
.notif-streak{background:linear-gradient(135deg,#ff6b00,#ff9500);--gc:#ff6b00}
.notif-speed{background:linear-gradient(135deg,#00d4ff,#0099ff);--gc:#00d4ff}
.notif-level{background:linear-gradient(135deg,#9b59b6,#8e44ad);--gc:#9b59b6}
.notif-challenge{background:linear-gradient(135deg,#2ecc71,#27ae60);--gc:#2ecc71}
nav{text-align:center;margin-bottom:20px;border-bottom:1px solid #333;padding-bottom:10px}
nav button{padding:8px 12px;cursor:pointer;background:#1a1a1a;border:1px solid #333;margin:3px;border-radius:6px;font-weight:500;transition:all .3s;color:#ccc;font-size:.85em}
nav button:hover{background:#2a2a2a;border-color:#4a9eff;color:#fff}
#user-header{display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}
.hbadge{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #333;padding:8px 16px;border-radius:20px;font-size:.9em;display:flex;align-items:center;gap:8px}
.hbadge .icon{font-size:1.2em}.hbadge .lbl{color:#888}.hbadge .val{color:#fff;font-weight:bold}
#lvl-prog{width:100px;height:6px;background:#333;border-radius:3px;overflow:hidden}
#lvl-bar{height:100%;background:linear-gradient(90deg,#4a9eff,#00d4ff);transition:width .5s}
#daily-chal{background:linear-gradient(135deg,#1a1a2e,#0f3460);border:1px solid #4a9eff44;border-radius:12px;padding:12px 20px;margin-bottom:20px;max-width:500px;margin-left:auto;margin-right:auto}
#daily-chal h4{margin:0 0 8px;color:#4a9eff;font-size:.9em}
#daily-chal .ctxt{font-size:1em;margin-bottom:8px}
#daily-chal .cprog{display:flex;align-items:center;gap:10px}
#daily-chal .pbar{flex:1;height:8px;background:#333;border-radius:4px;overflow:hidden}
#daily-chal .pfill{height:100%;background:linear-gradient(90deg,#4a9eff,#00ff88);transition:width .3s}
#daily-chal .ptxt{font-size:.85em;color:#888;min-width:60px;text-align:right}
#daily-chal.done{border-color:#2ecc71;background:linear-gradient(135deg,#1a2e1a,#0f4630)}
#daily-chal.done h4{color:#2ecc71}
.section{display:none;text-align:center}.section.active{display:block}.hidden{display:none!important}
#escribir{width:80%;height:80px;font-size:1.2rem;margin-bottom:20px;padding:10px;background:#151515;color:#fff;border:1px solid #333;border-radius:8px}
#output{margin-top:20px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;line-height:40px}
#settings{max-width:800px;margin:0 auto;text-align:left}
.color-config{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin:20px 0}
.color-item{background:#151515;padding:10px;border-radius:8px;border:1px solid #333}
.color-item label{display:block;margin-bottom:5px;font-weight:bold}
.color-item input[type=color]{width:100%;height:40px;cursor:pointer;border:none;border-radius:4px}
#timer-bar-container{width:80%;max-width:500px;height:30px;background:#151515;border:2px solid #333;border-radius:15px;margin:20px auto;overflow:hidden;position:relative}
#timer-bar{height:100%;background:linear-gradient(90deg,#0f0,#ff0,#f00);transition:width .1s linear}
#timer-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-weight:bold;text-shadow:1px 1px 2px #000}
#start-game-btn{padding:20px 40px;font-size:1.5rem;cursor:pointer;background:linear-gradient(135deg,#0f0,#0c0);color:#000;border:none;border-radius:12px;font-weight:bold;margin:20px;transition:all .3s}
#start-game-btn:hover{transform:scale(1.05);box-shadow:0 0 20px #0f06}
#question-container{margin:40px auto;min-height:100px;display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap}
#options-container{display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
.option-btn{padding:15px 25px;font-size:1.5rem;cursor:pointer;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:8px;transition:all .3s}
.option-btn:hover{background:#2a2a2a;transform:scale(1.05);border-color:#4a9eff}
#feedback{margin:20px;font-size:1.8rem;min-height:40px}
.correct{color:#0f0}.wrong{color:#f44}
#next-btn{padding:10px 20px;font-size:1rem;cursor:pointer;background:#1a1a1a;color:#fff;border:1px solid #4a9eff;border-radius:8px}
#word-input-container{margin:20px}
#word-guess{padding:12px;font-size:1.2rem;width:300px;background:#151515;color:#fff;border:1px solid #333;border-radius:8px}
#mode-stats{display:inline-flex;gap:15px;background:#151515;padding:8px 16px;border-radius:20px;font-size:.85em;margin-bottom:15px;border:1px solid #333}
#mode-stats span{color:#888}#mode-stats .sv{color:#fff;font-weight:bold}#mode-stats .sr{color:#ffd700}
#cascade-game{position:relative;width:90%;max-width:600px;height:450px;margin:15px auto;border:2px solid #333;background:linear-gradient(180deg,#0a0a0a,#111);border-radius:12px;overflow:hidden}
#cascade-game::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40px;background:linear-gradient(transparent,#f003);pointer-events:none}
.falling-shape{position:absolute;transition:top .05s linear;filter:drop-shadow(0 0 5px currentColor)}
#cascade-input{margin:15px auto;padding:12px;font-size:1.8rem;width:180px;text-align:center;background:#151515;color:#fff;border:2px solid #333;border-radius:8px}
#cascade-input:focus{border-color:#4a9eff;outline:none}
#cascade-controls{margin:10px 0}
#cascade-controls button{padding:10px 25px;margin:5px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:all .3s}
#casc-start{background:linear-gradient(135deg,#0f0,#0c0);color:#000}
#casc-stop{background:linear-gradient(135deg,#f44,#c00);color:#fff}
#cascade-info{display:flex;justify-content:center;gap:30px;margin:10px 0;font-size:1.1em}
.cstat{background:#151515;padding:8px 16px;border-radius:8px;border:1px solid #333}
#memory-display{min-height:120px;display:flex;justify-content:center;align-items:center;gap:15px;flex-wrap:wrap;margin:30px auto}
#memory-input{padding:12px;font-size:1.5rem;width:250px;text-align:center;background:#151515;color:#fff;border:1px solid #333;border-radius:8px;letter-spacing:5px}
#memory-level-info{font-size:1.2em;margin:15px 0;color:#4a9eff}
#confusion-info{background:#151515;border:1px solid #333;border-radius:12px;padding:20px;max-width:600px;margin:20px auto;text-align:left}
#confusion-pairs{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:15px}
.conf-pair{background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:10px;text-align:center}
.conf-pair .chars{font-size:1.5em;font-weight:bold}.conf-pair .cnt{font-size:.8em;color:#888}
#stats-section{max-width:900px;margin:0 auto}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:20px 0}
.stat-card{background:#151515;border:1px solid #333;border-radius:12px;padding:20px}
.stat-card h3{margin:0 0 15px;color:#4a9eff;font-size:1em}
#heatmap-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(50px,1fr));gap:5px;max-width:600px;margin:0 auto}
.hm-cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.2em;border-radius:8px;transition:transform .2s}
.hm-cell:hover{transform:scale(1.1)}
#progress-chart{width:100%;height:200px;background:#0a0a0a;border-radius:8px;position:relative;overflow:hidden}
.chart-line{position:absolute;bottom:0;left:0;right:0;height:1px;background:#333}
.chart-bar{position:absolute;bottom:0;width:20px;background:linear-gradient(180deg,#4a9eff,#4a9eff88);border-radius:4px 4px 0 0;transition:height .5s}
.chart-labels{display:flex;justify-content:space-between;margin-top:10px;font-size:.8em;color:#666}
#guide{max-width:980px;margin:0 auto;text-align:left;line-height:1.55}
#guide h2,#guide h3,#guide h4{text-align:left;color:#4a9eff}
#guide h3{margin-top:30px}
#guide p,#guide li{color:#ddd}
#guide a{color:#6ab7ff;text-decoration:none}
#guide a:hover{text-decoration:underline}
.shape-examples{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin:14px 0 18px}
.shape-example{background:#111;border:1px solid #333;border-radius:12px;padding:12px;text-align:center}
.shape-example-title{font-weight:bold;margin-bottom:8px;color:#fff}
.color-table{width:100%;border-collapse:collapse;margin:10px 0 18px;overflow:hidden;border-radius:12px}
.color-table th,.color-table td{border-bottom:1px solid #222;padding:10px 12px;text-align:left}
.color-table th{background:#111;color:#4a9eff}
.color-table tr:nth-child(even) td{background:#0a0a0a}
.color-table td:first-child{font-weight:bold;font-size:1.5em}
details.guide-details{background:#0a0a0a;border:1px solid #333;border-radius:12px;padding:10px 12px;margin:10px 0}
details.guide-details summary{cursor:pointer;font-weight:bold;color:#fff}
.guide-note{background:#101826;border:1px solid #27415f;padding:12px 14px;border-radius:12px;margin:14px 0}
.rank-novato{color:var(--rank0)}.rank-aprendiz{color:var(--rank1)}.rank-avanzado{color:var(--rank2)}.rank-experto{color:var(--rank3)}.rank-maestro{color:var(--rank4)}.rank-sinesteta{color:var(--rank5);text-shadow:0 0 10px var(--rank5glow)}
</style>
</head>
<body>
<div id="user-header">
<div class="hbadge"><span class="icon">üèÜ</span><span class="lbl">Nivel:</span><span id="user-rank" class="val rank-novato">Novato</span><div id="lvl-prog"><div id="lvl-bar" style="width:0%"></div></div></div>
<div class="hbadge"><span class="icon">üî•</span><span class="lbl">Racha:</span><span id="day-streak" class="val">0 d√≠as</span></div>
<div class="hbadge"><span class="icon">‚ö°</span><span class="lbl">XP:</span><span id="total-xp" class="val">0</span></div>
</div>
<div id="daily-chal">
<h4>üéØ DESAF√çO DIARIO</h4>
<div class="ctxt" id="chal-text">Cargando...</div>
<div class="cprog"><div class="pbar"><div class="pfill" id="chal-prog" style="width:0%"></div></div><div class="ptxt" id="chal-ptxt">0/0</div></div>
</div>
<nav>
<button onclick="showSection('guide')">üìñ Gu√≠a</button>
<button onclick="showSection('translator')">üìù Traductor</button>
<button onclick="showSection('settings')">‚öôÔ∏è Colores</button>
<button onclick="showSection('game-symbol-to-char')">üëÅÔ∏è Decodificar</button>
<button onclick="showSection('game-char-to-symbol')">üé® Color</button>
<button onclick="showSection('game-word')">üß† Palabra</button>
<button onclick="showSection('game-phrase')">üìö Frase</button>
<button onclick="showSection('game-memory')">üí≠ Memoria</button>
<button onclick="showSection('game-confusion')">üîÄ Confusiones</button>
<button onclick="showSection('stats')">üìä Progreso</button>
</nav>
<div id="guide" class="section active">
<h2>üìñ Gu√≠a de Sinestesia Grafema-Color</h2>
<h3>¬øQu√© es esto?</h3>
<p>Esta herramienta te ayuda a entrenar y visualizar la sinestesia grafema-color mediante repetici√≥n espaciada inteligente, donde cada letra, n√∫mero y s√≠mbolo tiene asociado un color y una forma espec√≠ficos. La idea es pasar de "decodificar conscientemente" a "reconocer autom√°ticamente".</p>
<div class="guide-note">
<strong>üß† Evidencia Cient√≠fica</strong><br/>
            Un estudio publicado en Nature Scientific Reports (<a href="https://www.nature.com/articles/srep07089" target="_blank">Bor et al., 2014</a>) demostr√≥ que adultos que siguieron un entrenamiento similar a este <strong>ganaron 12 puntos de CI</strong> despu√©s de entrenar asociaciones grafema-color. El entrenamiento en sinestesia puede mejorar significativamente las capacidades cognitivas.
        </div>
<h3>üèÜ Progreso, Rangos y Desaf√≠o Diario (Synth 2.3)</h3><p>Adem√°s de entrenar asociaciones, Synth 2.3 a√±ade un sistema de <strong>XP</strong>, <strong>rangos</strong> y <strong>racha diaria</strong> para que el progreso sea visible y constante.</p><ul>
<li><strong>XP:</strong> ganas XP por aciertos (y bonus por velocidad) y por completar objetivos.</li>
<li><strong>Rangos:</strong> Novato ‚Üí Aprendiz (500) ‚Üí Avanzado (2000) ‚Üí Experto (5000) ‚Üí Maestro (10000) ‚Üí Sinesteta (25000).</li>
<li><strong>Gana XP y sube de rango:</strong>
  <ul>
    <li><span class="rank-novato">Novato</span> ‚Äì 0 XP</li>
    <li><span class="rank-aprendiz">Aprendiz</span> ‚Äì 500 XP</li>
    <li><span class="rank-avanzado">Avanzado</span> ‚Äì 2.000 XP</li>
    <li><span class="rank-experto">Experto</span> ‚Äì 5.000 XP</li>
    <li><span class="rank-maestro">Maestro</span> ‚Äì 10.000 XP</li>
    <li><span class="rank-sinesteta">Sinesteta</span> ‚Äì 25.000 XP</li>
  </ul>
</li>

<li><strong>Racha diaria:</strong> se incrementa si juegas al menos una vez al d√≠a.</li>
<li><strong>Desaf√≠o diario:</strong> cada d√≠a aparece un reto (racha, aciertos, velocidad o Memoria). Al completarlo recibes XP extra.</li>
</ul><div class="guide-note"><strong>Tip:</strong> si solo tienes 2‚Äì3 minutos, completa el desaf√≠o diario. Es la forma m√°s f√°cil de mantener la racha.</div><h3>üé® Formas de los S√≠mbolos</h3>
<p>La <strong>forma</strong> codifica el tipo de car√°cter (may√∫scula/min√∫scula/acentos/n√∫meros) y el <strong>color</strong> codifica la identidad.</p>
<div class="shape-examples">
<div class="shape-example">
<div class="shape-example-title">Cuadrado</div>
<div class="block" style="background: #4a9eff; margin: 10px auto;"></div>
<p>Letras MAY√öSCULAS<br/>(A, B, C...)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">C√≠rculo</div>
<div class="circle" style="background: #4a9eff; margin: 10px auto;"></div>
<p>Letras min√∫sculas<br/>(a, b, c...)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">Tri√°ngulo</div>
<div class="triangle" style="border-bottom-color: #4a9eff; margin: 10px auto;"></div>
<p>N√∫meros<br/>(0, 1, 2...)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">Paralelogramo</div>
<div class="parallelogram" style="background: #4a9eff; margin: 10px auto;"></div>
<p>May√∫sculas con tilde<br/>(√Å, √â, √ç, √ì, √ö, √ë)</p>
</div>
<div class="shape-example">
<div class="shape-example-title">√ìvalo</div>
<div class="oval" style="background: #4a9eff; margin: 10px auto;"></div>
<p>Min√∫sculas con tilde<br/>(√°, √©, √≠, √≥, √∫, √±)</p>
</div>
</div>
<h3>üåà Colores de Letras y N√∫meros</h3>
<details class="guide-details" open="">
<summary>üìã Tabla completa de letras</summary>
<div style="margin-top: 10px;">
<table class="color-table">
<tr><th>Letra</th><th>Color</th><th>RGB</th></tr>
<tr><td style="color: rgb(55,55,225)">A/√Å</td><td>Azul</td><td>55,55,225</td></tr>
<tr><td style="color: rgb(255,85,168)">B</td><td>Rosa</td><td>255,85,168</td></tr>
<tr><td style="color: rgb(114,244,47)">C</td><td>Verde lima</td><td>114,244,47</td></tr>
<tr><td style="color: rgb(255,255,0)">D</td><td>Amarillo</td><td>255,255,0</td></tr>
<tr><td style="color: rgb(242,168,7)">E/√â</td><td>Naranja</td><td>242,168,7</td></tr>
<tr><td style="color: rgb(72,152,213)">F</td><td>Azul claro</td><td>72,152,213</td></tr>
<tr><td style="color: rgb(255,255,255)">G</td><td>Blanco</td><td>255,255,255</td></tr>
<tr><td style="color: rgb(140,140,140)">H</td><td>Gris</td><td>140,140,140</td></tr>
<tr><td style="color: rgb(220,209,50)">I/√ç</td><td>Amarillo p√°lido</td><td>220,209,50</td></tr>
<tr><td style="color: rgb(190,210,225)">J</td><td>Azul hielo</td><td>190,210,225</td></tr>
<tr><td style="color: rgb(170,170,170)">K</td><td>Gris claro</td><td>170,170,170</td></tr>
<tr><td style="color: rgb(255,148,173)">L</td><td>Rosa claro</td><td>255,148,173</td></tr>
<tr><td style="color: rgb(221,194,156)">M</td><td>Beige</td><td>221,194,156</td></tr>
<tr><td style="color: rgb(21,148,141)">N/√ë</td><td>Verde azulado</td><td>21,148,141</td></tr>
<tr><td style="color: rgb(240,120,0)">O/√ì</td><td>Naranja oscuro</td><td>240,120,0</td></tr>
<tr><td style="color: rgb(253,238,165)">P</td><td>Amarillo p√°lido</td><td>253,238,165</td></tr>
<tr><td style="color: rgb(255,0,0)">Q</td><td>Rojo</td><td>255,0,0</td></tr>
<tr><td style="color: rgb(28,130,15)">R</td><td>Verde oscuro</td><td>28,130,15</td></tr>
<tr><td style="color: rgb(183,31,143)">S</td><td>Magenta</td><td>183,31,143</td></tr>
<tr><td style="color: rgb(172,128,77)">T</td><td>Marr√≥n</td><td>172,128,77</td></tr>
<tr><td style="color: rgb(0,170,80)">U/√ö</td><td>Verde</td><td>0,170,80</td></tr>
<tr><td style="color: rgb(189,247,255)">V</td><td>Celeste</td><td>189,247,255</td></tr>
<tr><td style="color: rgb(123,20,95)">W</td><td>P√∫rpura</td><td>123,20,95</td></tr>
<tr><td style="color: rgb(190,25,25)">X</td><td>Rojo oscuro</td><td>190,25,25</td></tr>
<tr><td style="color: rgb(209,240,163)">Y</td><td>Verde amarillento</td><td>209,240,163</td></tr>
<tr><td style="color: rgb(116,61,37)">Z</td><td>Marr√≥n oscuro</td><td>116,61,37</td></tr>
</table>
</div>
</details>
<details class="guide-details">
<summary>üî¢ Tabla de n√∫meros</summary>
<div style="margin-top: 10px;">
<table class="color-table">
<tr><th>N√∫mero</th><th>Coincide con</th></tr>
<tr><td style="color: rgb(240,120,0)">0</td><td>O (naranja oscuro)</td></tr>
<tr><td style="color: rgb(255,148,173)">1</td><td>L (rosa claro)</td></tr>
<tr><td style="color: rgb(255,255,0)">2</td><td>D (amarillo)</td></tr>
<tr><td style="color: rgb(221,194,156)">3</td><td>M (beige)</td></tr>
<tr><td style="color: rgb(21,148,141)">4</td><td>N (verde azulado)</td></tr>
<tr><td style="color: rgb(183,31,143)">5</td><td>S (magenta)</td></tr>
<tr><td style="color: rgb(255,85,168)">6</td><td>B (rosa)</td></tr>
<tr><td style="color: rgb(172,128,77)">7</td><td>T (marr√≥n)</td></tr>
<tr><td style="color: rgb(255,255,255)">8</td><td>G (blanco)</td></tr>
<tr><td style="color: rgb(255,0,0)">9</td><td>Q (rojo)</td></tr>
</table>
</div>
</details>
<h3>üéÆ Modos de Juego</h3>
<ul>
<li><strong>üëÅÔ∏è Decodificar S√≠mbolo:</strong> Ves una forma de color y debes identificar qu√© letra, n√∫mero o s√≠mbolo es.</li>
<li><strong>üé® Encontrar Color:</strong> Ves una letra o n√∫mero y debes seleccionar su color correcto.</li>
<li><strong>üß† Decodificar Palabra:</strong> Lees una palabra codificada y la tecleas respetando may√∫sculas/min√∫sculas (10 segundos).</li>
<li><strong>üìö Decodificar Frase:</strong> Lee frases completas en contexto. El cerebro usa el contexto sem√°ntico para predecir (20 segundos).</li>
<li><strong>üí≠ Modo Memoria:</strong> Memoriza una secuencia de s√≠mbolos y escr√≠bela. La longitud sube con tu nivel.</li><li><strong>üîÄ Modo Confusiones:</strong> Practica tus pares m√°s confusos. Se alimenta autom√°ticamente de tus fallos.</li><li><strong>üìä Progreso:</strong> Mapa de dominio, actividad reciente y top confusiones para saber qu√© reforzar.</li></ul>
<h3>üìù Traductor</h3><p>En <strong>üìù Traductor</strong> puedes escribir cualquier texto y verlo convertido en s√≠mbolos. √ötil para practicar fuera de los juegos o para crear material (por ejemplo, listas de palabras).</p><h3>üí≠ Detalles del Modo Memoria</h3><p>Se muestra una secuencia de s√≠mbolos durante unos segundos. Despu√©s aparece un cuadro para escribirla. Si aciertas, subes de nivel; si fallas, bajas un nivel (m√≠nimo nivel 1). El mejor nivel queda guardado como r√©cord.</p><h3>üîÄ Detalles del Modo Confusiones</h3><p>Cada vez que fallas en un modo con opciones, se registra el par <em>correcto ‚Üî elegido</em>. Este modo te propone precisamente esos s√≠mbolos para que la confusi√≥n desaparezca.</p><h3>üéØ Sistema de Repetici√≥n Espaciada</h3>
<p>El programa aprende de tus errores. Los s√≠mbolos que fallas aparecen m√°s frecuentemente hasta que los domines. Este sistema inteligente optimiza tu entrenamiento ajustando autom√°ticamente un "peso" por s√≠mbolo.</p>
<h3>‚è±Ô∏è Temporizador Adaptativo</h3>
<ul>
<li><strong>Tiempo inicial:</strong> 5s (s√≠mbolos), 10s (palabras), 20s (frases)</li>
<li><strong>Si aciertas:</strong> tiempo se reduce un 10% (m√°s dif√≠cil)</li>
<li><strong>Si fallas:</strong> tiempo aumenta un 10% (m√°s f√°cil)</li>
<li><strong>L√≠mites:</strong> m√≠nimo 0.3s (¬°para expertos!), m√°ximo seg√∫n el modo</li>
</ul>
<h3>üèÜ Sistema de R√©cords</h3><p>Synth guarda autom√°ticamente tus mejores marcas (y las muestra como notificaciones):</p><ul>
<li><strong>Decodificar / Color:</strong> mejor racha y mejor tiempo (respuesta m√°s r√°pida).</li>
<li><strong>Palabra / Frase:</strong> mejor racha.</li>
<li><strong>Memoria:</strong> mejor nivel alcanzado y mejor racha en ese modo.</li>
</ul><h3>üìä Estad√≠sticas y Progreso</h3><p>En la pesta√±a <strong>üìä Progreso</strong> ver√°s:</p><ul>
<li><strong>Mapa de dominio:</strong> cada s√≠mbolo se colorea seg√∫n tu precisi√≥n (verde = dominas, rojo = necesitas pr√°ctica). El tooltip muestra % y n√∫mero de intentos.</li>
<li><strong>Actividad (√∫ltimos 7 d√≠as):</strong> barras con tus aciertos diarios.</li>
<li><strong>Top confusiones:</strong> los pares que m√°s confundes, para atacar el problema de ra√≠z.</li>
</ul><div class="guide-note"><strong>Guardado:</strong> todo se guarda en tu navegador (localStorage). Si cambias de dispositivo o borras datos del navegador, se reinicia. Tambi√©n puedes usar <strong>üóëÔ∏è Borrar estad√≠sticas</strong> para empezar de cero.</div>

<h3>‚öôÔ∏è Personalizaci√≥n</h3><p>¬°La sinestesia es personal! En <strong>‚öôÔ∏è Colores</strong> puedes ajustar la paleta:</p><ul>
<li>Cambia el color de cada letra/n√∫mero (y sus equivalentes con tilde: A/√Å, E/√â, I/√ç, O/√ì, U/√ö, y N/√ë).</li>
<li>Las min√∫sculas heredan el color de su may√∫scula (por ejemplo, <em>a</em> usa el color de <em>A</em>).</li>
<li>Usa <strong>Restaurar colores</strong> para volver a los valores por defecto.</li>
</ul><p>Si quieres reiniciar completamente el progreso, usa <strong>üóëÔ∏è Borrar estad√≠sticas</strong> en la secci√≥n de Progreso.</p>


<h3>üí° Consejos</h3>
<ul>
<li>Practica regularmente para fortalecer las asociaciones color-letra</li>
<li>Haz sesiones cortas pero frecuentes (mejor 10 min diarios que 1 hora semanal)</li>
<li>Usa el traductor para visualizar textos completos</li>
<li>Puedes cargar archivos de texto (.txt) en el traductor</li>
<li>Los signos de puntuaci√≥n aparecen en blanco para ser visibles</li>
<li>En palabra y frase: debes respetar may√∫sculas y min√∫sculas exactamente</li>
<li>Las estad√≠sticas se guardan por cada modo de juego</li>
<li>La pr√°ctica constante puede mejorar tus capacidades cognitivas</li>
</ul>
<h3>üë®‚Äçüíª Cr√©ditos</h3>
<p>Dise√±ado por <a href="https://www.linkedin.com/in/alberto-fla%C3%B1o-lombardo-762618259/" style="font-weight: bold;" target="_blank">Alberto Fla√±o Lombardo</a></p>
</div>
<div id="translator" class="section">
<h2>üìù Traductor de Texto a Color</h2>
<textarea id="escribir" placeholder="Escribe aqu√≠..."></textarea>
<div><label for="file-input" style="cursor:pointer;padding:10px 20px;background:#1a1a1a;border:1px solid #333;border-radius:8px;display:inline-block;margin:10px">üìÑ Cargar archivo</label>
<input type="file" id="file-input" accept=".txt" style="display:none"></div>
<div id="output"></div>
</div>
<div id="settings" class="section">
<h2>‚öôÔ∏è Configuraci√≥n de Colores</h2>
<p>Personaliza los colores seg√∫n tu sinestesia.</p>
<button onclick="resetColors()" style="padding:10px 20px;margin:20px;background:#f44;color:#fff;border:none;border-radius:8px;cursor:pointer">üîÑ Restaurar</button>
<div id="color-config-container" class="color-config"></div>
</div>
<div id="game-area" class="section">
<h2 id="game-title">Modo Juego</h2>
<div id="mode-stats">
<span>‚ö° Racha: <span id="current-streak" class="sv">0</span>/<span id="best-streak" class="sr">0</span></span>
<span>üéØ Puntos: <span id="score" class="sv">0</span></span>
<span>‚è±Ô∏è Mejor: <span id="best-time" class="sr">--</span></span>
</div>
<button id="start-game-btn" onclick="startGameWithTimer()">‚ñ∂Ô∏è Iniciar Juego</button>
<div id="timer-bar-container" class="hidden"><div id="timer-bar" style="width:100%"></div><div id="timer-text">5.0s</div></div>
<div id="question-container"></div>
<div id="options-container"></div>
<div id="word-input-container" class="hidden"><input type="text" id="word-guess" placeholder="Escribe..." autocomplete="off"></div>
<div id="feedback"></div>
<button id="next-btn" onclick="continueAfterError()" class="hidden">Siguiente ‚û°</button>
</div>
<div id="memory-section" class="section">
<h2>üí≠ Modo Memoria</h2>
<p>Memoriza la secuencia y escr√≠bela</p>
<div id="mode-stats">
<span>üìä Nivel: <span id="memory-level" class="sv">1</span></span>
<span>‚ö° Racha: <span id="memory-streak" class="sv">0</span></span>
<span>üèÜ Mejor: <span id="memory-best" class="sr">1</span></span>
</div>
<div id="memory-level-info">Nivel 1: 3 s√≠mbolos</div>
<button id="memory-start-btn" onclick="startMemoryRound()">‚ñ∂Ô∏è Iniciar</button>
<div id="memory-display"></div>
<div id="memory-input-container" class="hidden"><input type="text" id="memory-input" placeholder="Escribe la secuencia..." autocomplete="off" maxlength="20"></div>
<div id="memory-feedback"></div>
</div>
<div id="confusion-section" class="section">
<h2>üîÄ Modo Confusiones</h2>
<p>Practica los s√≠mbolos que m√°s confundes</p>
<div id="confusion-info"><h4>Tus confusiones m√°s frecuentes:</h4><div id="confusion-pairs"><p style="color:#666;text-align:center">Juega otros modos para detectar confusiones</p></div></div>
<button id="confusion-start-btn" onclick="startConfusionMode()" class="hidden">‚ñ∂Ô∏è Practicar</button>
<div id="confusion-game" class="hidden"><div id="confusion-question"></div><div id="confusion-options"></div></div>
<div id="confusion-feedback"></div>
</div>
<div id="stats" class="section">
<h2>üìä Tu Progreso</h2>
<div class="stats-grid">
<div class="stat-card"><h3>üó∫Ô∏è Mapa de Dominio</h3><p style="font-size:.85em;color:#666;margin-bottom:15px">Verde = dominas, Rojo = necesitas pr√°ctica</p><div id="heatmap-container"></div></div>
<div class="stat-card"><h3>üìà Actividad (√∫ltimos 7 d√≠as)</h3><div id="progress-chart"></div><div class="chart-labels"><span>Hace 7 d√≠as</span><span>Hoy</span></div></div>
<div class="stat-card"><h3>üéØ Estad√≠sticas</h3><div style="display:grid;gap:10px"><div>Total aciertos: <strong id="stat-correct">0</strong></div><div>Total fallos: <strong id="stat-wrong">0</strong></div><div>Precisi√≥n: <strong id="stat-acc">100%</strong></div><div>Mejor racha: <strong id="stat-streak">0</strong></div></div></div>
<div class="stat-card"><h3>üîÄ Top Confusiones</h3><div id="top-confusions"><p style="color:#666">Sin datos a√∫n</p></div></div>
</div>
<button onclick="resetAllStats()" style="margin-top:20px;padding:10px 20px;background:#f442;color:#f44;border:1px solid #f44;border-radius:8px;cursor:pointer">üóëÔ∏è Borrar estad√≠sticas</button>
</div>
<script>
const defaultColors={A:'55,55,225',B:'255,85,168',C:'114,244,47',D:'255,255,0',E:'242,168,7',F:'72,152,213',G:'255,255,255',H:'140,140,140',I:'220,209,50',J:'190,210,225',K:'170,170,170',L:'255,148,173',M:'221,194,156',N:'21,148,141','√ë':'21,148,141',O:'240,120,0',P:'253,238,165',Q:'255,0,0',R:'28,130,15',S:'183,31,143',T:'172,128,77',U:'0,170,80',V:'189,247,255',W:'123,20,95',X:'190,25,25',Y:'209,240,163',Z:'116,61,37','1':'255,148,173','2':'255,255,0','3':'221,194,156','4':'21,148,141','5':'183,31,143','6':'255,85,168','7':'172,128,77','8':'255,255,255','9':'255,0,0','0':'240,120,0',' ':'0,0,0','√Å':'55,55,225','√â':'242,168,7','√ç':'220,209,50','√ì':'240,120,0','√ö':'0,170,80'};
let colors={...defaultColors};
function updateRankColors(){
  // Asocia los colores de los rangos a los colores de los d√≠gitos 0..5
  const root=document.documentElement;
  const rgb=(v,fallback)=>'rgb('+(v||fallback)+')';
  const rgba=(v,fallback,a)=>'rgba('+(v||fallback)+','+a+')';
  root.style.setProperty('--rank0', rgb(colors['0'], '136,136,136'));
  root.style.setProperty('--rank1', rgb(colors['1'], '74,158,255'));
  root.style.setProperty('--rank2', rgb(colors['2'], '170,110,255'));
  root.style.setProperty('--rank3', rgb(colors['3'], '255,160,0'));
  root.style.setProperty('--rank4', rgb(colors['4'], '255,60,60'));
  root.style.setProperty('--rank5', rgb(colors['5'], '0,255,136'));
  root.style.setProperty('--rank5glow', rgba(colors['5'], '0,255,136', .4));
}

const words=["hola","casa","Sol","gato","luz","Color","azul","rojo","mar","Luna","noche","D√≠a","arte","mesa","puerta","ciudad","flor","paz","amor","sue√±o","caf√©"];
const phrases=["El sol brilla","Veo la luna","Casa grande","Gato negro","Luz azul","Mar profundo","Noche oscura","D√≠a claro","Arte bello","Paz total"];
const modeTitles={'game-symbol-to-char':'üëÅÔ∏è Decodificar','game-char-to-symbol':'üé® Encontrar Color','game-word':'üß† Palabra','game-phrase':'üìö Frase'};
const ranks=[{name:'Novato',xp:0,c:'rank-novato'},{name:'Aprendiz',xp:500,c:'rank-aprendiz'},{name:'Avanzado',xp:2000,c:'rank-avanzado'},{name:'Experto',xp:5000,c:'rank-experto'},{name:'Maestro',xp:10000,c:'rank-maestro'},{name:'Sinesteta',xp:25000,c:'rank-sinesteta'}];
const challenges=[{type:'streak',target:10,text:'Racha de 10 aciertos',xp:50},{type:'streak',target:20,text:'Racha de 20 aciertos',xp:100},{type:'correct',target:30,text:'Acierta 30 s√≠mbolos',xp:50},{type:'correct',target:50,text:'Acierta 50 s√≠mbolos',xp:75},{type:'speed',target:3,text:'3 respuestas en <0.5s',xp:100},{type:'memory',target:5,text:'Nivel 5 en Memoria',xp:75}];
let weights={},mode='',question=null,score=0,streak=0;
let data={xp:0,dayStreak:0,lastPlay:null,correct:0,wrong:0,bestStreak:0,dailyCorrect:0,dailyMaxStreak:0,dailyFast:0,confusions:{},symbolStats:{},records:{'game-symbol-to-char':{streak:0,time:null},'game-char-to-symbol':{streak:0,time:null},'game-word':{streak:0},'game-phrase':{streak:0},memory:{level:1,streak:0},cascade:{score:0,streak:0}},challenge:null,chalDate:null,chalProg:0,chalDone:false};
let timerInt=null,gameOn=false,qActive=false,qStart=0,maxTime=5000,timeLeft=5000;
let cascInt=null,cascShapes=[],cascLives=3,cascScore=0,cascStreak=0;
let memLevel=1,memSeq=[],memStreak=0;

function init(){getAllSymbols().forEach(s=>{weights[s]=10;if(!data.symbolStats[s])data.symbolStats[s]={c:0,w:0}});}
function load(){const s=localStorage.getItem('synth5');if(s)try{Object.assign(data,JSON.parse(s))}catch(e){};const c=localStorage.getItem('synth_colors');if(c)try{Object.assign(colors,JSON.parse(c))}catch(e){};updateRankColors();checkStreak();checkChallenge();updateHeader();updateChallengeUI();}
function save(){localStorage.setItem('synth5',JSON.stringify(data));}
function saveColors(){localStorage.setItem('synth_colors',JSON.stringify(colors));}
function resetColors(){colors={...defaultColors};localStorage.removeItem('synth_colors');buildColorConfig();updateRankColors();alert('Colores restaurados');}
function resetAllStats(){if(confirm('¬øBorrar todas las estad√≠sticas?')){localStorage.removeItem('synth5');location.reload();}}
function today(){return new Date().toISOString().split('T')[0];}
function checkStreak(){const t=today(),l=data.lastPlay;if(!l)data.dayStreak=0;else if(l!==t){const d=Math.floor((new Date(t)-new Date(l))/(864e5));if(d===1)data.dayStreak++;else if(d>1)data.dayStreak=0;}}
function markPlayed(){const t=today();if(data.lastPlay!==t){data.lastPlay=t;data.dailyCorrect=0;data.dailyMaxStreak=0;data.dailyFast=0;checkStreak();data.dayStreak=Math.max(1,data.dayStreak);save();updateHeader();}}
function checkChallenge(){const t=today();if(data.chalDate!==t){const c=challenges[Math.floor(Math.random()*challenges.length)];data.challenge=c;data.chalDate=t;data.chalProg=0;data.chalDone=false;save();}}
function updateChallengeProgress(){if(!data.challenge||data.chalDone)return;const c=data.challenge;let p=0;if(c.type==='streak')p=data.dailyMaxStreak;else if(c.type==='correct')p=data.dailyCorrect;else if(c.type==='speed')p=data.dailyFast;else if(c.type==='memory')p=data.records.memory.level;else if(c.type==='cascade')p=data.records.cascade.score;data.chalProg=p;if(p>=c.target&&!data.chalDone){data.chalDone=true;addXP(c.xp);notify('challenge','¬°Desaf√≠o completado! +'+c.xp+' XP');}updateChallengeUI();save();}
function updateChallengeUI(){const el=document.getElementById('daily-chal');if(!data.challenge)return;const c=data.challenge,p=data.chalProg||0,t=c.target;document.getElementById('chal-text').textContent=c.text+(data.chalDone?' ‚úÖ':' (+'+c.xp+' XP)');document.getElementById('chal-prog').style.width=Math.min(100,p/t*100)+'%';document.getElementById('chal-ptxt').textContent=Math.min(p,t)+'/'+t;el.classList.toggle('done',data.chalDone);}
function addXP(n){const old=getRank();data.xp+=n;const now=getRank();if(now.name!==old.name)notify('level','¬°Subiste a '+now.name+'!');updateHeader();save();}
function getRank(){for(let i=ranks.length-1;i>=0;i--)if(data.xp>=ranks[i].xp)return ranks[i];return ranks[0];}
function getNextRank(){const c=getRank(),i=ranks.findIndex(r=>r.name===c.name);return ranks[i+1]||null;}
function updateHeader(){const r=getRank(),n=getNextRank();document.getElementById('user-rank').textContent=r.name;document.getElementById('user-rank').className='val '+r.c;document.getElementById('day-streak').textContent=data.dayStreak+' d√≠as';document.getElementById('total-xp').textContent=data.xp.toLocaleString();if(n)document.getElementById('lvl-bar').style.width=((data.xp-r.xp)/(n.xp-r.xp)*100)+'%';else document.getElementById('lvl-bar').style.width='100%';}
function recordConfusion(a,b){const k=[a.toUpperCase(),b.toUpperCase()].sort().join('-');data.confusions[k]=(data.confusions[k]||0)+1;save();}
function getTopConf(n=5){return Object.entries(data.confusions).sort((a,b)=>b[1]-a[1]).slice(0,n);}
function getConfSymbols(){const c=getTopConf(10),s=new Set();c.forEach(([p,n])=>{if(n>=2){const[a,b]=p.split('-');s.add(a);s.add(b);}});return Array.from(s);}
function notify(type,msg){document.querySelectorAll('.notif').forEach(n=>n.remove());const d=document.createElement('div');d.className='notif notif-'+type;d.innerHTML=msg;document.body.appendChild(d);setTimeout(()=>{d.classList.add('out');setTimeout(()=>d.remove(),500);},2500);}
function getShape(c){if('√ë√Å√â√ç√ì√ö'.includes(c))return'parallelogram';if('√±√°√©√≠√≥√∫'.includes(c))return'oval';if(c>='A'&&c<='Z')return'block';if(c>='a'&&c<='z')return'circle';if(c>='0'&&c<='9')return'triangle';return'punctuation';}
function makeShape(c){const u=c.toUpperCase(),col=colors[u]||'0,0,0',sh=getShape(c);if(c===' '){const s=document.createElement('div');s.style.cssText='width:20px;height:30px;display:inline-block';return s;}if(sh==='punctuation'){const s=document.createElement('span');s.className='punctuation';s.textContent=c;return s;}const d=document.createElement('div');d.className=sh;if(sh==='triangle')d.style.borderBottomColor='rgb('+col+')';else d.style.backgroundColor='rgb('+col+')';return d;}
function wrapScale(el,s){const w=document.createElement('div');w.style.display='inline-block';w.style.transform='scale('+s+')';w.style.transformOrigin='center';w.appendChild(el);return w;}
function getAllSymbols(){const s=[];'ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ√Å√â√ç√ì√ö'.split('').forEach(c=>s.push(c));'abcdefghijklmn√±opqrstuvwxyz√°√©√≠√≥√∫'.split('').forEach(c=>s.push(c));'0123456789'.split('').forEach(c=>s.push(c));return s;}
function weightedRandom(){const items=Object.keys(weights),total=items.reduce((s,i)=>s+weights[i],0);let r=Math.random()*total,sum=0;for(let i of items){sum+=weights[i];if(r<=sum)return i;}return items[0];}
function particles(x,y,col){for(let i=0;i<12;i++){const p=document.createElement('div');p.className='particle';p.style.left=x+'px';p.style.top=y+'px';p.style.backgroundColor='rgb('+col+')';const a=(Math.PI*2*i)/12,d=100+Math.random()*50;p.style.setProperty('--tx',Math.cos(a)*d+'px');p.style.setProperty('--ty',Math.sin(a)*d+'px');document.body.appendChild(p);setTimeout(()=>p.remove(),800);}}
function rgbToHex(r){const[a,b,c]=r.split(',').map(v=>parseInt(v.trim()));return'#'+[a,b,c].map(x=>x.toString(16).padStart(2,'0')).join('');}
function hexToRgb(h){return parseInt(h.slice(1,3),16)+','+parseInt(h.slice(3,5),16)+','+parseInt(h.slice(5,7),16);}
function translate(t){const o=document.getElementById('output');o.innerHTML='';for(const c of t)o.appendChild(makeShape(c));}
function buildColorConfig(){const c=document.getElementById('color-config-container');c.innerHTML='';'ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ√Å√â√ç√ì√ö0123456789'.split('').forEach(l=>{const col=colors[l];if(!col)return;const d=document.createElement('div');d.className='color-item';const lb=document.createElement('label');lb.textContent=l;lb.style.color='rgb('+col+')';const inp=document.createElement('input');inp.type='color';inp.value=rgbToHex(col);inp.onchange=e=>{colors[l]=hexToRgb(e.target.value);lb.style.color='rgb('+colors[l]+')';saveColors();updateRankColors();};d.appendChild(lb);d.appendChild(inp);c.appendChild(d);});updateRankColors();}

window.showSection=function(m){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));if(m==='guide')document.getElementById('guide').classList.add('active');else if(m==='translator')document.getElementById('translator').classList.add('active');else if(m==='settings'){document.getElementById('settings').classList.add('active');buildColorConfig();}else if(m==='game-memory'){document.getElementById('memory-section').classList.add('active');resetMemory();}else if(m==='game-confusion'){document.getElementById('confusion-section').classList.add('active');setupConfusion();}else if(m==='stats'){document.getElementById('stats').classList.add('active');updateStats();}else{document.getElementById('game-area').classList.add('active');startGame(m);}};
function startGame(m){mode=m;score=0;streak=0;document.getElementById('game-title').textContent=modeTitles[m]||'Juego';maxTime=m==='game-phrase'?20000:m==='game-word'?10000:5000;gameOn=false;qActive=false;updateModeStats();document.getElementById('start-game-btn').classList.remove('hidden');document.getElementById('timer-bar-container').classList.add('hidden');document.getElementById('question-container').innerHTML='';document.getElementById('options-container').innerHTML='';document.getElementById('feedback').textContent='';}
window.startGameWithTimer=function(){gameOn=true;markPlayed();document.getElementById('start-game-btn').classList.add('hidden');document.getElementById('timer-bar-container').classList.remove('hidden');nextQ();};
function updateModeStats(){if(!mode||!data.records[mode])return;const r=data.records[mode];document.getElementById('current-streak').textContent=streak;document.getElementById('best-streak').textContent=r.streak||0;document.getElementById('score').textContent=score;document.getElementById('best-time').textContent=r.time?(r.time/1000).toFixed(2)+'s':'--';}
function startTimer(){if(timerInt)clearInterval(timerInt);qActive=true;timeLeft=maxTime;qStart=Date.now();timerInt=setInterval(()=>{const e=Date.now()-qStart;timeLeft=maxTime-e;if(timeLeft<=0){clearInterval(timerInt);qActive=false;handleWrong(question,null,true);}else updateTimerDisplay();},100);}
function stopTimer(){if(timerInt){clearInterval(timerInt);timerInt=null;}qActive=false;}
function updateTimerDisplay(){document.getElementById('timer-bar').style.width=(timeLeft/maxTime*100)+'%';document.getElementById('timer-text').textContent=(timeLeft/1000).toFixed(1)+'s';}
function handleCorrect(sym){if(!qActive)return;const rt=Date.now()-qStart;stopTimer();weights[sym]=Math.max(1,weights[sym]-2);const st=data.symbolStats[sym.toUpperCase()];if(st)st.c++;const col=colors[sym.toUpperCase()]||'255,255,255';particles(innerWidth/2,innerHeight/2,col);document.getElementById('feedback').innerHTML="<span class='correct'>¬°CORRECTO!</span>";score++;streak++;data.correct++;data.dailyCorrect++;recordDailyActivity();let xp=5;if(rt<500){xp+=5;data.dailyFast++;}addXP(xp);if(streak>data.dailyMaxStreak)data.dailyMaxStreak=streak;if(streak>data.bestStreak)data.bestStreak=streak;const r=data.records[mode];if(streak>(r.streak||0)){r.streak=streak;notify('streak','üî• ¬°Racha r√©cord: '+streak+'!');}if((mode==='game-symbol-to-char'||mode==='game-char-to-symbol')&&(r.time===null||rt<r.time)){r.time=rt;notify('speed','‚ö° ¬°Velocidad: '+(rt/1000).toFixed(2)+'s!');}const minT=mode==='game-phrase'?3000:mode==='game-word'?1500:300;maxTime=Math.max(minT,maxTime*0.9);updateModeStats();updateChallengeProgress();save();setTimeout(nextQ,800);}
function handleWrong(ans,wrong,timeout){if(!qActive&&!timeout)return;stopTimer();weights[ans]=Math.min(50,weights[ans]+5);if(wrong)recordConfusion(ans,wrong);const st=data.symbolStats[ans.toUpperCase()];if(st)st.w++;data.wrong++;const col=colors[ans.toUpperCase()]||'255,255,255';document.getElementById('feedback').innerHTML="<span class='wrong'>"+(timeout?'‚è±Ô∏è ':'')+"Era: </span><span style='color:rgb("+col+");font-weight:bold;font-size:1.5em'>"+ans+"</span>";streak=0;maxTime=Math.min(mode==='game-phrase'?20000:mode==='game-word'?10000:5000,maxTime*1.1);updateModeStats();save();showCorrectOption(ans);}
window.continueAfterError=function(){document.getElementById('next-btn').classList.add('hidden');nextQ();};
window.nextQ=function(){if(!gameOn)return;const qC=document.getElementById('question-container'),oC=document.getElementById('options-container'),wC=document.getElementById('word-input-container'),fb=document.getElementById('feedback'),nb=document.getElementById('next-btn'),wi=document.getElementById('word-guess');qC.innerHTML='';oC.innerHTML='';fb.textContent='';wC.classList.add('hidden');nb.classList.add('hidden');wi.value='';if(mode==='game-symbol-to-char'){const c=weightedRandom();question=c;const sh=makeShape(c),sw=wrapScale(sh,2.5);sw.style.margin='20px';qC.appendChild(sw);genOpts(c,getAllSymbols(),'text');startTimer();}else if(mode==='game-char-to-symbol'){const c=weightedRandom();question=c;const d=document.createElement('div');d.textContent=c;d.style.fontSize='4rem';d.style.fontWeight='bold';qC.appendChild(d);genOpts(c,getAllSymbols(),'visual');startTimer();}else if(mode==='game-word'){const w=words[Math.floor(Math.random()*words.length)];question=w;const wc=document.createElement('div');wc.style.cssText='display:flex;gap:5px;flex-wrap:wrap;justify-content:center';for(let c of w)wc.appendChild(makeShape(c));qC.appendChild(wc);wC.classList.remove('hidden');wi.focus();startTimer();}else if(mode==='game-phrase'){const p=phrases[Math.floor(Math.random()*phrases.length)];question=p;const pc=document.createElement('div');pc.style.cssText='display:flex;gap:5px;flex-wrap:wrap;justify-content:center';for(let c of p)pc.appendChild(makeShape(c));qC.appendChild(pc);wC.classList.remove('hidden');wi.focus();startTimer();}};
function genOpts(correct,all,type){let opts=[correct];while(opts.length<4){let r=all[Math.floor(Math.random()*all.length)];if(!opts.includes(r))opts.push(r);}opts.sort(()=>Math.random()-0.5);opts.forEach(o=>{const btn=document.createElement('button');btn.className='option-btn';btn.dataset.char=o;if(type==='text')btn.textContent=o;else{const sh=makeShape(o),sw=wrapScale(sh,1.5);btn.appendChild(sw);}btn.onclick=()=>{if(!qActive)return;if(o===correct)handleCorrect(correct);else handleWrong(correct,o,false);};document.getElementById('options-container').appendChild(btn);});}
function checkWord(){if(!qActive)return;const v=document.getElementById('word-guess').value.trim();if(v===question){stopTimer();document.getElementById('feedback').innerHTML="<span class='correct'>¬°Excelente!</span>";score+=5;streak++;data.correct++;data.dailyCorrect++;addXP(15);if(streak>data.dailyMaxStreak)data.dailyMaxStreak=streak;if(streak>data.bestStreak)data.bestStreak=streak;const r=data.records[mode];if(streak>(r.streak||0)){r.streak=streak;notify('streak','üî• ¬°Racha: '+streak+'!');}const minT=mode==='game-phrase'?3000:1500;maxTime=Math.max(minT,maxTime*0.9);updateModeStats();updateChallengeProgress();save();particles(innerWidth/2,300,'255,255,0');setTimeout(nextQ,1000);}else if(v.length===question.length)handleWrong(question,null,false);}
function showCorrectOption(ans){const btns=document.querySelectorAll('.option-btn');btns.forEach(btn=>{const isCorrect=(btn.textContent===ans)||(btn.dataset&&btn.dataset.char===ans);if(isCorrect){btn.style.border='3px solid #0f0';btn.style.boxShadow='0 0 15px #0f0';btn.onclick=()=>{nextQ();};}else{btn.style.opacity='0.3';btn.onclick=null;}});if(mode==='game-word'||mode==='game-phrase'){document.getElementById('next-btn').classList.remove('hidden');}}
function recordDailyActivity(){const t=today();if(!data.activityHistory)data.activityHistory={};data.activityHistory[t]=data.dailyCorrect;const keys=Object.keys(data.activityHistory).sort();if(keys.length>14){delete data.activityHistory[keys[0]];}save();}
function resetMemory(){memLevel=1;memStreak=0;memSeq=[];updateMemoryUI();document.getElementById('memory-display').innerHTML='';document.getElementById('memory-input-container').classList.add('hidden');document.getElementById('memory-feedback').textContent='';document.getElementById('memory-start-btn').classList.remove('hidden');}
function updateMemoryUI(){document.getElementById('memory-level').textContent=memLevel;document.getElementById('memory-streak').textContent=memStreak;document.getElementById('memory-best').textContent=data.records.memory.level||1;document.getElementById('memory-level-info').textContent='Nivel '+memLevel+': '+(memLevel+2)+' s√≠mbolos';}
window.startMemoryRound=function(){markPlayed();document.getElementById('memory-start-btn').classList.add('hidden');document.getElementById('memory-feedback').textContent='';document.getElementById('memory-input-container').classList.add('hidden');const len=memLevel+2;memSeq=[];const base='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';for(let i=0;i<len;i++)memSeq.push(base[Math.floor(Math.random()*base.length)]);const disp=document.getElementById('memory-display');disp.innerHTML='';memSeq.forEach((c,i)=>{const sh=makeShape(c),sw=wrapScale(sh,1.8);sw.style.opacity='0';sw.style.transition='opacity 0.3s';disp.appendChild(sw);setTimeout(()=>{sw.style.opacity='1';},i*400);});setTimeout(()=>{disp.innerHTML='<p style="color:#666">¬øCu√°l era la secuencia?</p>';document.getElementById('memory-input-container').classList.remove('hidden');document.getElementById('memory-input').value='';document.getElementById('memory-input').maxLength=memSeq.length;document.getElementById('memory-input').focus();},memSeq.length*400+1500);};
function checkMemory(){const inp=document.getElementById('memory-input').value.toUpperCase(),correct=memSeq.join('');if(inp===correct){memStreak++;memLevel++;addXP(10+memLevel*2);if(memLevel>data.records.memory.level){data.records.memory.level=memLevel;notify('level','üí≠ ¬°Nivel r√©cord: '+memLevel+'!');}document.getElementById('memory-feedback').innerHTML='<span class="correct">¬°Correcto!</span>';updateMemoryUI();updateChallengeProgress();save();setTimeout(startMemoryRound,1500);}else{document.getElementById('memory-feedback').innerHTML='<span class="wrong">Era: '+correct+'</span>';memStreak=0;memLevel=Math.max(1,memLevel-1);updateMemoryUI();save();document.getElementById('memory-input-container').classList.add('hidden');document.getElementById('memory-start-btn').classList.remove('hidden');}}
function setupConfusion(){const conf=getTopConf(10),cont=document.getElementById('confusion-pairs');if(conf.length===0){cont.innerHTML='<p style="color:#666;text-align:center">Juega otros modos para detectar confusiones</p>';document.getElementById('confusion-start-btn').classList.add('hidden');return;}cont.innerHTML='';conf.forEach(([pair,cnt])=>{const[a,b]=pair.split('-'),colA=colors[a]||'255,255,255',colB=colors[b]||'255,255,255';const d=document.createElement('div');d.className='conf-pair';d.innerHTML='<div class="chars"><span style="color:rgb('+colA+')">'+a+'</span> ‚Üî <span style="color:rgb('+colB+')">'+b+'</span></div><div class="cnt">'+cnt+'x</div>';cont.appendChild(d);});document.getElementById('confusion-start-btn').classList.remove('hidden');}
window.startConfusionMode=function(){const syms=getConfSymbols();if(syms.length<2){alert('No hay suficientes confusiones. ¬°Sigue practicando!');return;}markPlayed();document.getElementById('confusion-info').classList.add('hidden');document.getElementById('confusion-start-btn').classList.add('hidden');document.getElementById('confusion-game').classList.remove('hidden');confQuestion(syms);};
function confQuestion(syms){const correct=syms[Math.floor(Math.random()*syms.length)],qC=document.getElementById('confusion-question'),oC=document.getElementById('confusion-options');qC.innerHTML='';oC.innerHTML='';document.getElementById('confusion-feedback').textContent='';const sh=makeShape(correct),sw=wrapScale(sh,2.5);sw.style.margin='20px';qC.appendChild(sw);let opts=[correct];const others=syms.filter(s=>s!==correct);while(opts.length<Math.min(4,syms.length)&&others.length>0)opts.push(others.splice(Math.floor(Math.random()*others.length),1)[0]);opts.sort(()=>Math.random()-0.5);opts.forEach(o=>{const btn=document.createElement('button');btn.className='option-btn';btn.dataset.char=o;btn.textContent=o;btn.onclick=()=>{if(o===correct){document.getElementById('confusion-feedback').innerHTML='<span class="correct">¬°Correcto!</span>';addXP(10);data.correct++;save();particles(innerWidth/2,300,colors[correct]||'255,255,255');setTimeout(()=>confQuestion(syms),800);}else{document.getElementById('confusion-feedback').innerHTML='<span class="wrong">Era: '+correct+'</span>';recordConfusion(correct,o);data.wrong++;save();setTimeout(()=>confQuestion(syms),1500);}};oC.appendChild(btn);});}
function updateCascadeUI(){document.getElementById('cascade-points').textContent=cascScore;document.getElementById('cascade-streak').textContent=cascStreak;document.getElementById('cascade-best').textContent=data.records.cascade.score||0;document.getElementById('lives-count').textContent=cascLives;}
function startCascade(){stopCascade();markPlayed();cascLives=3;cascScore=0;cascStreak=0;cascShapes=[];updateCascadeUI();document.getElementById('cascade-game').innerHTML='';document.getElementById('cascade-input').value='';document.getElementById('cascade-input').focus();let spawnRate=0.25,fallSpeed=2;cascInt=setInterval(()=>{if(cascScore>0&&cascScore%50===0){spawnRate=Math.min(0.5,spawnRate+0.02);fallSpeed=Math.min(5,fallSpeed+0.2);}if(Math.random()<spawnRate&&cascShapes.length<8){const sym=weightedRandom(),inner=makeShape(sym),sh=wrapScale(inner,1.8);sh.dataset.char=sym;sh.classList.add('falling-shape');sh.style.left=(10+Math.random()*80)+'%';sh.style.top='-40px';document.getElementById('cascade-game').appendChild(sh);cascShapes.push({el:sh,char:sym,top:-40});}for(let i=cascShapes.length-1;i>=0;i--){const s=cascShapes[i];s.top+=fallSpeed;s.el.style.top=s.top+'px';if(s.top>410){s.el.remove();cascShapes.splice(i,1);cascLives--;cascStreak=0;updateCascadeUI();if(cascLives<=0)endCascade();}}},50);}
function endCascade(){stopCascade();if(cascScore>data.records.cascade.score){data.records.cascade.score=cascScore;notify('level','üéÆ ¬°R√©cord: '+cascScore+'!');}updateChallengeProgress();save();setTimeout(()=>alert('¬°Fin! Puntuaci√≥n: '+cascScore),100);}
function stopCascade(){if(cascInt){clearInterval(cascInt);cascInt=null;}cascShapes.forEach(s=>s.el.remove());cascShapes=[];}
function checkCascade(){const inp=document.getElementById('cascade-input'),typed=inp.value.trim();if(!typed)return;const idx=cascShapes.findIndex(s=>s.char===typed);if(idx!==-1){const m=cascShapes[idx],col=colors[m.char.toUpperCase()]||'255,255,255';const r=m.el.getBoundingClientRect();particles(r.left+15,r.top+15,col);m.el.remove();cascShapes.splice(idx,1);cascScore+=10;cascStreak++;data.correct++;addXP(3);if(cascStreak>data.records.cascade.streak)data.records.cascade.streak=cascStreak;updateCascadeUI();weights[m.char]=Math.max(1,weights[m.char]-2);}else{cascStreak=0;updateCascadeUI();}inp.value='';}
function updateStats(){buildHeatmap();buildChart();const t=data.correct+data.wrong,acc=t>0?Math.round(data.correct/t*100):100;document.getElementById('stat-correct').textContent=data.correct.toLocaleString();document.getElementById('stat-wrong').textContent=data.wrong.toLocaleString();document.getElementById('stat-acc').textContent=acc+'%';document.getElementById('stat-streak').textContent=data.bestStreak;const conf=getTopConf(5),tc=document.getElementById('top-confusions');if(conf.length===0){tc.innerHTML='<p style="color:#666">Sin datos a√∫n</p>';return;}tc.innerHTML='';conf.forEach(([pair,cnt],i)=>{const[a,b]=pair.split('-'),colA=colors[a]||'255,255,255',colB=colors[b]||'255,255,255';const d=document.createElement('div');d.style.cssText='display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #222';d.innerHTML='<span>'+(i+1)+'. <span style="color:rgb('+colA+');font-weight:bold">'+a+'</span> ‚Üî <span style="color:rgb('+colB+');font-weight:bold">'+b+'</span></span><span style="color:#888">'+cnt+'x</span>';tc.appendChild(d);});}
function buildHeatmap(){const c=document.getElementById('heatmap-container');c.innerHTML='';'ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ0123456789'.split('').forEach(sym=>{const st=data.symbolStats[sym],t=st?st.c+st.w:0,acc=t>0?st.c/t:0.5;let r,g;if(acc<0.5){r=255;g=Math.round(acc*2*255);}else{r=Math.round((1-acc)*2*255);g=255;}const col=colors[sym]||'150,150,150',bg=t>0?'rgb('+r+','+g+',0)':'#333';const cell=document.createElement('div');cell.className='hm-cell';cell.style.backgroundColor=bg;cell.style.color='rgb('+col+')';cell.textContent=sym;cell.title=sym+': '+(t>0?Math.round(acc*100)+'%':'Sin datos')+' ('+t+')';c.appendChild(cell);});}
function buildChart(){const c=document.getElementById('progress-chart');c.innerHTML='';const days=7,bw=(c.offsetWidth-40)/days;const t=today();const hist=data.activityHistory||{};const dates=[];for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);dates.push(d.toISOString().split('T')[0]);}const maxVal=Math.max(50,...dates.map(d=>hist[d]||0));dates.forEach((date,i)=>{const bar=document.createElement('div');bar.className='chart-bar';bar.style.left=(20+i*bw)+'px';bar.style.width=(bw-10)+'px';const val=hist[date]||0;const h=maxVal>0?(val/maxVal)*100:0;bar.style.height=h+'%';bar.title=date+': '+val+' aciertos';c.appendChild(bar);});[25,50,75].forEach(p=>{const l=document.createElement('div');l.className='chart-line';l.style.bottom=p+'%';c.appendChild(l);});}
document.addEventListener('DOMContentLoaded',()=>{init();load();const ta=document.getElementById('escribir');if(ta)ta.oninput=e=>translate(e.target.value);const fi=document.getElementById('file-input');if(fi)fi.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{ta.value=ev.target.result;translate(ev.target.result);};r.readAsText(f);}};const wi=document.getElementById('word-guess');if(wi){wi.oninput=function(){if(question&&this.value.length>=question.length)checkWord();};wi.onkeypress=e=>{if(e.key==='Enter')checkWord();};}const ci=document.getElementById('cascade-input');if(ci)ci.oninput=()=>{if(cascInt)checkCascade();};const mi=document.getElementById('memory-input');if(mi){mi.oninput=function(){if(this.value.length>=memSeq.length)checkMemory();};mi.onkeypress=e=>{if(e.key==='Enter')checkMemory();};}});
</script>
</body>
</html>
